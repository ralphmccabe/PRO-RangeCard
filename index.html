<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>Apex Ballistics</title>
    <link rel="manifest" href="manifest.json">
    <script>
        // Suppress manifest CORS error on local file protocol
        if (window.location.protocol === 'file:') {
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) manifestLink.remove();
        }
    </script>
    <script src="tailwind.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap"
        rel="stylesheet">
    <script src="html2canvas.min.js"></script>
    <script src="lucide.min.js"></script>
    <!-- Leaflet.js (CDN) -->
    <link rel="stylesheet" href="leaflet.css">
    <script src="leaflet.js"></script>
    <script src="idb_helper.js"></script>
    <!-- Esri Leaflet (Satellite) - Using Defer to prevent blocking fallback -->
    <script defer src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>
    <script>
        console.log('Checking lucide load status...');
        if (typeof lucide === 'undefined') {
            console.warn('Global "lucide" is undefined.');
            if (typeof window.lucide !== 'undefined') {
                console.log('Found window.lucide! It should be available.');
            } else if (typeof exports === 'object' && exports.lucide) {
                console.log('Found lucide in "exports". Exposing to window.');
                window.lucide = exports.lucide;
            } else if (typeof exports === 'object' && exports.createIcons) {
                // Sometimes it exports the module content directly to exports
                console.log('Found lucide functions in "exports". Exposing to window.lucide.');
                window.lucide = exports;
            } else {
                console.error('Lucide library failed to load or register globally.');
            }
        } else {
            console.log('Lucide loaded successfully v' + (lucide.version || 'unknown'));
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            /* High Visibility - Brighter Neutral Charcoal */
            --dark-bg: #404040;
            --panel-bg: #525252;
            --text-primary: #ffffff;
            --text-secondary: #e5e5e5;
            --border-color: #737373;
            --input-bg: #404040;
            --input-border: #a3a3a3;
            --accent-color: #22c55e;
            --neon-green: #22c55e;
            --input-text: #ffffff;
            --placeholder-color: #a3a3a3;
        }

        body {
            background-color: #404040;
            color: #ffffff;
        }

        .input-field {
            width: 100%;
            background-color: var(--input-bg) !important;
            border: 1px solid var(--input-border) !important;
            border-radius: 6px;
            padding: 12px 10px !important;
            font-size: 16px !important;
            /* Prevents iOS zoom */
            color: var(--input-text) !important;
            transition: all 0.2s;
            display: block;
            margin-bottom: 4px;
        }

        .input-field::placeholder {
            color: var(--placeholder-color);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--neon-green) !important;
            background: var(--input-bg) !important;
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        }

        #date,
        #time,
        #session-category,
        #weapon-profile-select,
        #modal-weapon-profile-select {
            color: #94a3b8 !important;
        }

        .light-theme #date,
        .light-theme #time,
        .light-theme #session-category,
        .light-theme #weapon-profile-select,
        .light-theme #modal-weapon-profile-select {
            color: #475569 !important;
        }

        .section-label {
            display: block;
            font-size: 11px;
            font-weight: 800;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
            margin-top: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.25rem;
        }

        #card-container span[id^="display-"] {
            display: inline-block;
            transform: translateY(-3px);
            line-height: normal;
        }

        /* --- TACTICAL COMPASS HUD STYLES --- */
        .glow-amber {
            color: #f59e0b;
            --glow-rgb: 245, 158, 11;
        }

        .glow-red {
            color: #ef4444;
            --glow-rgb: 239, 68, 68;
        }

        .glow-green {
            color: #10b981;
            --glow-rgb: 16, 185, 129;
        }

        .glow-container {
            transition: color 0.5s ease-in-out;
            text-shadow: 0 0 10px rgba(var(--glow-rgb), 0.5);
        }

        .custom-div-icon {
            background: transparent !important;
            border: none !important;
            pointer-events: auto !important;
            z-index: 1000 !important;
        }

        .bg-scan-line {
            background: linear-gradient(to bottom,
                    transparent 50%,
                    rgba(var(--glow-rgb), 0.1) 50.5%,
                    rgba(var(--glow-rgb), 0.1) 51%,
                    transparent 51.5%,
                    transparent 100%);
            background-size: 100% 4px;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            from {
                background-position: 0 0;
            }

            to {
                background-position: 0 100%;
            }
        }

        #hud-compass-card::before {
            content: '';
            position: absolute;
            inset: 10px;
            border: 1px dashed currentColor;
            border-radius: 50%;
            opacity: 0.2;
        }

        /* Visibility and Layout Hardening */
        .hidden {
            display: none !important;
        }

        @media (max-width: 1024px) {
            #intelHubModal .max-w-4xl {
                height: 100% !important;
                max-height: 100vh !important;
                border-radius: 0 !important;
                margin: 0 !important;
            }
        }

        /* Strict Orientation Logic for Scope Cam */
        @media (orientation: portrait) {
            #scope-cam-controls-portrait {
                display: flex !important;
            }

            #scope-cam-controls-landscape {
                display: none !important;
            }

            #intel-scope-cam {
                flex-direction: column !important;
            }

            #scope-monitor-container {
                flex: 1 1 auto !important;
                height: 50vh !important;
            }
        }

        @media (orientation: landscape) {
            #scope-cam-controls-portrait {
                display: none !important;
            }

            #scope-cam-controls-landscape {
                display: flex !important;
            }

            #intel-scope-cam {
                flex-direction: row !important;
            }

            #intel-scope-cam .w-full.md\:w-\[250px\] {
                width: 160px !important;
                border-top: 0 !important;
                border-right: 1px solid rgba(255, 255, 255, 0.05) !important;
            }
        }
    </style>

</head>

<body
    class="bg-neutral-700 text-white min-h-screen font-sans selection:bg-neon-green selection:text-black overflow-x-hidden">

    <!-- Mobile View Toggle (Floating Action Button) -->
    <button id="mobileViewToggle"
        class="lg:hidden fixed bottom-6 right-6 z-[1000] bg-neon-green text-black p-4 rounded-full shadow-2xl flex items-center justify-center active:scale-95 transition-all">
        <i id="toggleIcon" data-lucide="eye" class="w-6 h-6"></i>
    </button>

    <div id="mainLayout" class="flex flex-col lg:flex-row min-h-screen lg:h-screen lg:overflow-hidden">
        <!-- LEFT PANEL: CONTROLS & INPUTS -->
        <aside
            class="w-full lg:w-1/3 bg-neutral-800 border-r border-neutral-600 flex flex-col h-auto lg:h-full lg:overflow-hidden shadow-2xl relative z-10 transition-colors duration-300">
            <div class="p-6 border-b border-neutral-600 bg-neutral-800 z-30 shrink-0 transition-colors duration-300">
                <div class="flex justify-between items-start">
                    <h1
                        class="text-2xl font-bold tracking-tighter text-neon-green uppercase flex items-center gap-2 relative">
                        <i data-lucide="crosshair" class="w-6 h-6 text-neon-green"></i>
                        <span class="text-neon-green">Range Data</span>
                        <span class="text-sm text-gray-400 italic font-normal normal-case ml-1">ProVersion</span>
                    </h1>
                    <!-- Theme Toggle -->
                    <div class="flex items-center gap-1 bg-neutral-700/60 p-1 rounded-lg border border-neutral-600">
                        <button onclick="window.setTheme('light')"
                            class="p-1.5 rounded transition-all hover:bg-neutral-600 group" title="Light Theme">
                            <i data-lucide="sun" class="w-4 h-4 text-neutral-300 group-hover:text-yellow-400"></i>
                        </button>
                        <button onclick="window.setTheme('dark')"
                            class="p-1.5 rounded transition-all hover:bg-neutral-600 group"
                            title="Dark Background Theme">
                            <i data-lucide="moon" class="w-4 h-4 text-neutral-200 group-hover:text-white"></i>
                        </button>
                    </div>
                </div>
                <p class="text-xs text-neutral-300 mt-1 uppercase tracking-widest flex justify-between items-center">
                    <span>Ballistics & Environment Log</span>
                    <span id="save-status" class="text-neon-green font-bold text-[8px] animate-pulse"></span>
                </p>
            </div>

            <!-- Scrollable Form Area -->
            <div class="flex-1 lg:overflow-y-auto p-6 pb-24 space-y-8 custom-scrollbar">

                <!-- Profile Manager -->
                <div class="space-y-4">
                    <span class="section-label">Data Management</span>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="openLibraryBtn" type="button"
                            class="flex-1 bg-gray-800 hover:bg-[var(--accent-color)]/10 border border-gray-700 rounded p-2 text-xs font-bold flex items-center justify-center gap-2 transition-all">
                            <i data-lucide="library" class="w-4 h-4 text-neon-green"></i>
                            OPEN LIBRARY
                        </button>
                        <button id="saveProfileBtnManual"
                            class="flex-1 bg-gray-800 hover:bg-[var(--accent-color)]/10 border border-gray-700 rounded p-2 text-xs font-bold flex items-center justify-center gap-2 transition-all">
                            <i data-lucide="save" class="w-4 h-4 text-blue-400"></i>
                            SAVE CURRENT
                        </button>
                        <button id="clearFormBtn"
                            class="col-span-2 bg-black/20 hover:bg-red-900/40 border border-red-900/40 hover:border-red-500 rounded p-2 text-xs font-bold text-red-500 hover:text-white flex items-center justify-center gap-2 transition-all mt-1">
                            <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
                            CLEAR ALL DATA
                        </button>
                        <button id="colorCycleBtn"
                            class="col-span-2 bg-[var(--input-bg)]/40 hover:bg-gray-800/60 border border-gray-700/50 rounded p-2 text-xs font-bold text-gray-400 hover:text-white flex items-center justify-center gap-2 transition-all mt-1 uppercase">
                            <i data-lucide="palette" class="w-4 h-4"></i>
                            FLAVORS
                        </button>

                        <div class="col-span-2 grid grid-cols-2 gap-2 mt-1">
                            <button id="importProfilesBtn"
                                class="bg-black/20 hover:bg-purple-900/40 border border-purple-900/40 hover:border-purple-500 rounded p-2 text-[10px] font-bold text-purple-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="image-plus" class="w-4 h-4"></i>
                                IMPORT IMAGES
                            </button>
                            <button id="openIntelBtn"
                                class="bg-black/20 hover:bg-blue-900/40 border border-blue-900/40 hover:border-blue-500 rounded p-2 text-[10px] font-bold text-blue-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="brain-circuit" class="w-4 h-4"></i>
                                INTEL HUB
                            </button>
                            <button onclick="window.openUKDTrainer()"
                                class="bg-black/20 hover:bg-orange-900/40 border border-orange-900/40 hover:border-orange-500 rounded p-2 text-[10px] font-bold text-orange-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="target" class="w-4 h-4 text-orange-500"></i>
                                UKD TRAINER
                            </button>

                            <button onclick="window.exportAsImage()"
                                class="bg-black/20 hover:bg-green-900/40 border border-green-900/40 hover:border-green-500 rounded p-2 text-[10px] font-bold text-green-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="image" class="w-4 h-4"></i>
                                EXPORT IMAGE
                            </button>
                            <button onclick="window.shareSession()"
                                class="bg-neutral-800/40 hover:bg-neutral-700/60 border border-neutral-600/50 rounded p-2 text-[10px] font-bold text-cyan-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                <i data-lucide="share-2" class="w-4 h-4"></i>
                                SHARE
                            </button>
                        </div>
                        <!-- Hidden file input for import -->
                        <input type="file" id="importFileInput" accept="image/png,image/jpeg,image/jpg,image/webp"
                            multiple class="hidden">
                    </div>

                    <!-- Hidden elements for state -->
                    <select id="profileSelect" class="hidden"></select>
                    <button id="deleteProfileBtn" class="hidden"></button>

                    <!-- Weapon Profiles Section -->
                    <section class="space-y-3 border-t border-neutral-600 pt-4">
                        <span class="section-label group flex items-center gap-2 cursor-pointer"
                            onclick="document.getElementById('weaponProfilesForm').classList.toggle('hidden')">
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            <i data-lucide="target" class="w-4 h-4 text-emerald-500"></i>
                            Weapon Profiles
                        </span>
                        <div id="weaponProfilesForm" class="space-y-3">
                            <!-- Quick Switch Dropdown -->
                            <div class="flex gap-2">
                                <select id="weapon-profile-select" onchange="loadWeaponProfile(this.value)"
                                    class="flex-1 input-field text-xs">
                                    <option value="">-- Select Profile --</option>
                                </select>
                                <button onclick="saveCurrentAsWeaponProfile()"
                                    class="bg-green-900/30 border border-green-700/50 text-green-400 px-3 py-2 rounded text-[10px] font-bold uppercase hover:bg-green-800/50 transition-colors">
                                    <i data-lucide="plus" class="w-3 h-3 inline"></i> Save
                                </button>
                            </div>
                            <!-- Profile List -->
                            <div id="weapon-profiles-list" class="space-y-2">
                                <p class="text-xs text-gray-500 italic">No weapon profiles saved yet.</p>
                            </div>
                        </div>
                    </section>

                    <!-- Reload Data Form -->
                    <section class="space-y-4">
                        <span class="section-label">SESSION INFO</span>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label for="header-notes" class="sr-only">Header Notes</label>
                                <input type="text" id="header-notes" class="input-field" placeholder="Header Notes">
                            </div>
                            <div class="col-span-2">
                                <label for="shooter-company" class="sr-only">Shooter Name / Company</label>
                                <input type="text" id="shooter-company" class="input-field"
                                    placeholder="Shooter Name / Company">
                            </div>
                            <div class="col-span-1">
                                <label for="date" class="sr-only">Date</label>
                                <input type="date" id="date" class="input-field" placeholder="Date" autocomplete="off">
                            </div>
                            <div class="col-span-1">
                                <label for="time" class="sr-only">Time</label>
                                <input type="time" id="time" class="input-field" placeholder="Time" autocomplete="off">
                            </div>
                            <div class="col-span-2">
                                <label for="session-category" class="sr-only">Session Category</label>
                                <select id="session-category" class="input-field">
                                    <option value="">Session Category (Optional)</option>
                                    <option value="sniper">ü¶Ö Sniper / Spotter</option>
                                    <option value="swat">üè¢ SWAT / Urban</option>
                                    <option value="competition">üèÜ Competition</option>
                                    <option value="training">üéØ Training</option>
                                    <option value="load-development">üî¨ Load Development</option>
                                    <option value="zero-confirmation">‚úì Zero Confirmation</option>
                                    <option value="long-range">üìè Long Range</option>
                                    <option value="practice">üìù Practice</option>
                                    <option value="testing">üß™ Testing</option>
                                </select>
                            </div>
                            <!-- Mission Data Section (Hidden by default) -->
                            <div id="form-section-mission"
                                class="col-span-2 pt-2 hidden bg-neutral-800 p-2 rounded border border-blue-900/30">
                                <span class="section-label text-blue-400">MISSION DATA</span>
                                <div class="grid grid-cols-2 gap-2 mt-2">
                                    <label for="mission-id" class="sr-only">Mission ID</label>
                                    <input type="text" id="mission-id" class="input-field" placeholder="Mission ID">
                                    <label for="team-id" class="sr-only">Team ID</label>
                                    <input type="text" id="team-id" class="input-field" placeholder="Team ID">
                                    <label for="sniper-name" class="sr-only">Sniper Name</label>
                                    <input type="text" id="sniper-name" class="input-field" placeholder="Sniper Name">
                                    <label for="spotter-name" class="sr-only">Spotter Name</label>
                                    <input type="text" id="spotter-name" class="input-field" placeholder="Spotter Name">
                                    <label for="radio-freq" class="sr-only">Radio Freq</label>
                                    <input type="text" id="radio-freq" class="input-field" placeholder="Radio Freq">
                                    <label for="callsign" class="sr-only">Callsign</label>
                                    <input type="text" id="callsign" class="input-field" placeholder="Callsign">
                                    <label for="sector-fire" class="sr-only">Sector of Fire</label>
                                    <textarea id="sector-fire" class="input-field col-span-2 h-16"
                                        placeholder="Sector of Fire / Instructions"></textarea>
                                </div>
                            </div>

                            <!-- Load Information Section -->
                            <div class="col-span-2 pt-2">
                                <span class="section-label">RELOAD DATA</span>
                            </div>
                            <div class="col-span-1">
                                <label for="caliber" class="sr-only">Caliber</label>
                                <input type="text" id="caliber" class="input-field" placeholder="Caliber">
                            </div>
                            <div class="col-span-1">
                                <label for="zero" class="sr-only">Zero Range</label>
                                <input type="text" id="zero" class="input-field" placeholder="Zero">
                            </div>
                            <div class="col-span-1">
                                <label for="barrel" class="sr-only">Barrel Info</label>
                                <input type="text" id="barrel" class="input-field" placeholder="Barrel">
                            </div>
                            <div class="col-span-1">
                                <label for="bullet" class="sr-only">Bullet Info</label>
                                <input type="text" id="bullet" class="input-field" placeholder="Bullet">
                            </div>
                            <div class="col-span-1">
                                <label for="load" class="sr-only">Load Weight</label>
                                <input type="text" id="load" class="input-field" placeholder="Load (gr)">
                            </div>
                            <div class="col-span-1">
                                <label for="powder" class="sr-only">Powder Info</label>
                                <input type="text" id="powder" class="input-field" placeholder="Powder">
                            </div>
                            <div class="col-span-1">
                                <label for="primer" class="sr-only">Primer Type</label>
                                <input type="text" id="primer" class="input-field" placeholder="Primer">
                            </div>
                            <div class="col-span-1">
                                <label for="col" class="sr-only">C.O.L</label>
                                <input type="text" id="col" class="input-field" placeholder="C.O.L">
                            </div>
                            <!-- New Row: Rings | Velocity -->
                            <div class="col-span-1">
                                <label for="rings" class="sr-only">Rings</label>
                                <input type="text" id="rings" class="input-field" placeholder="Rings">
                            </div>
                            <div class="col-span-1">
                                <label for="velocity" class="sr-only">Muzzle Velocity</label>
                                <input type="text" id="velocity" class="input-field" placeholder="Velocity">
                            </div>
                            <!-- New Row: G1 | Environment -->
                            <div class="col-span-1">
                                <label for="g1" class="sr-only">G1 / Ballistic Coefficient</label>
                                <input type="text" id="g1" class="input-field" placeholder="G-1 / BC">
                            </div>
                            <div class="col-span-1">
                                <label for="environment-summary" class="sr-only">Environment</label>
                                <input type="text" id="environment-summary" class="input-field"
                                    placeholder="Environment">
                            </div>
                            <!-- Environment Section -->
                            <div class="col-span-2 pt-2">
                                <span class="section-label">Environment</span>
                            </div>
                            <!-- Structured Weather Inputs -->
                            <div class="col-span-1">
                                <label for="temperature" class="sr-only">Temperature</label>
                                <input type="text" id="temperature" class="input-field" placeholder="Temp (¬∞F)">
                            </div>
                            <div class="col-span-1">
                                <label for="humidity" class="sr-only">Humidity</label>
                                <input type="text" id="humidity" class="input-field" placeholder="Humidity (%)">
                            </div>
                            <div class="col-span-1">
                                <label for="pressure" class="sr-only">Pressure</label>
                                <input type="text" id="pressure" class="input-field" placeholder="Pressure (inHg)">
                            </div>
                            <div class="col-span-1">
                                <label for="wind-speed" class="sr-only">Wind Speed</label>
                                <input type="text" id="wind-speed" class="input-field" placeholder="Wind (mph)">
                            </div>
                            <div class="col-span-1">
                                <label for="wind-dir" class="sr-only">Wind Direction</label>
                                <input type="text" id="wind-dir" class="input-field" placeholder="Wind Dir (¬∞)">
                            </div>
                            <div class="col-span-1">
                                <label for="cosine" class="sr-only">Cosine Factor</label>
                                <input type="text" id="cosine" class="input-field border-blue-500/30"
                                    placeholder="Cosine Factor">
                            </div>
                            <div class="col-span-1">
                                <label for="misc" class="sr-only">Misc</label>
                                <input type="text" id="misc" class="input-field" placeholder="Misc:">
                            </div>
                            <!-- Keep Copy Button -->
                            <div class="col-span-2">
                                <button id="copyLoadDataBtn" onclick="copyLoadData(this)"
                                    class="w-full bg-purple-950/20 hover:bg-purple-900/40 border border-purple-900/40 hover:border-purple-500 rounded p-2 text-[10px] font-bold text-purple-400 hover:text-white flex items-center justify-center gap-2 transition-all mt-1">
                                    <i data-lucide="clipboard-copy" class="w-4 h-4"></i>
                                    COPY LOAD DATA SUMMARY
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- SOLUTION Section -->
                    <section class="space-y-4">
                        <span class="section-label">SOLUTION</span>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-1">
                                <label for="elevation" class="sr-only">Elevation</label>
                                <input type="text" id="elevation" class="input-field" placeholder="Elevation">
                            </div>
                            <div class="col-span-1">
                                <label for="hold-data" class="sr-only">Hold</label>
                                <input type="text" id="hold-data" class="input-field" placeholder="Hold">
                            </div>
                            <div class="col-span-2 relative flex items-center gap-2">
                                <label for="final-dope" class="sr-only">Final DOPE</label>
                                <input type="text" id="final-dope" class="input-field border-neon-green/50 flex-1"
                                    placeholder="Final DOPE">
                                <button onclick="copyFinalDope(this)"
                                    class="p-2 bg-gray-800 hover:bg-neon-green/20 border border-gray-700 hover:border-neon-green/50 rounded transition-all"
                                    title="Copy Final Dope">
                                    <i data-lucide="copy" class="w-3.5 h-3.5 text-gray-500"></i>
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- EQUIPMENT Section -->
                    <section class="space-y-4">
                        <span class="section-label">EQUIPMENT</span>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2">
                                <label for="rifle-notes" class="sr-only">Rifle Notes</label>
                                <input type="text" id="rifle-notes" class="input-field" placeholder="Rifle/Pistol">
                            </div>
                            <div class="col-span-1">
                                <label for="scope-notes" class="sr-only">Scope Notes</label>
                                <input type="text" id="scope-notes" class="input-field" placeholder="Scope Settings">
                            </div>
                            <div class="col-span-1">
                                <label for="lrf-notes" class="sr-only">LRF Notes</label>
                                <input type="text" id="lrf-notes" class="input-field" placeholder="LRF Notes">
                            </div>
                        </div>
                    </section>

                    <!-- TARGET DATA Section -->
                    <section class="space-y-4">
                        <span class="section-label">TARGET DATA</span>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-1">
                                <label for="targetSize" class="sr-only">Target Size</label>
                                <input type="text" id="targetSize" class="input-field" placeholder="Target Size">
                            </div>
                            <div class="col-span-1">
                                <label for="groupSize" class="sr-only">Group Size</label>
                                <input type="text" id="groupSize" class="input-field" placeholder="Group Size">
                            </div>
                            <div class="col-span-1">
                                <label for="wind-notes" class="sr-only">Wind Notes</label>
                                <input type="text" id="wind-notes" class="input-field" placeholder="Wind Notes">
                            </div>
                            <div class="col-span-1">
                                <label for="direction-notes" class="sr-only">Direction Notes</label>
                                <input type="text" id="direction-notes" class="input-field"
                                    placeholder="Direction / LOS">
                            </div>
                        </div>
                    </section>

                    <!-- 3 SHOTS Section -->
                    <section class="space-y-4">

                        <span class="section-label group flex items-center gap-2">
                            TARGET LIST
                        </span>
                        <div class="space-y-4">
                            <!-- Existing T1-T3 -->
                            <div class="grid grid-cols-[2.5rem_1fr_1fr] items-center gap-2">
                                <span class="text-[10px] font-bold text-gray-500 uppercase">T1:</span>
                                <label for="shooting-angle" class="sr-only">T1 Shot Direction</label>
                                <input type="text" id="shooting-angle" class="input-field"
                                    placeholder="Shot Direction in Degrees">
                                <label for="compass-range" class="sr-only">T1 Range</label>
                                <input type="text" id="compass-range" class="input-field" placeholder="Range">
                            </div>
                            <div class="grid grid-cols-[2.5rem_1fr_1fr] items-center gap-2">
                                <span class="text-[10px] font-bold text-gray-500 uppercase">T2:</span>
                                <label for="shooting-angle-2" class="sr-only">T2 Shot Direction</label>
                                <input type="text" id="shooting-angle-2" class="input-field"
                                    placeholder="Shot Direction in Degrees">
                                <label for="compass-range-2" class="sr-only">T2 Range</label>
                                <input type="text" id="compass-range-2" class="input-field" placeholder="Range">
                            </div>
                            <div class="grid grid-cols-[2.5rem_1fr_1fr] items-center gap-2">
                                <span class="text-[10px] font-bold text-gray-500 uppercase">T3:</span>
                                <label for="shooting-angle-3" class="sr-only">T3 Shot Direction</label>
                                <input type="text" id="shooting-angle-3" class="input-field"
                                    placeholder="Shot Direction in Degrees">
                                <label for="compass-range-3" class="sr-only">T3 Range</label>
                                <input type="text" id="compass-range-3" class="input-field" placeholder="Range">
                            </div>

                            <!-- Grade Your Hold Section -->
                            <div class="space-y-4 pt-2">
                                <span class="section-label">Grade Your Hold</span>

                                <div
                                    class="flex flex-col items-center gap-4 bg-neutral-800/40 border border-neutral-600 p-6 rounded-lg">
                                    <span class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em]">Wind
                                        Call
                                        Dial</span>

                                    <!-- Rotary Wind Call Dial -->
                                    <div class="relative w-40 h-40 flex items-center justify-center">
                                        <!-- Outer Ring -->
                                        <div
                                            class="absolute w-full h-full rounded-full border-2 border-neutral-600 bg-gradient-to-br from-neutral-800 to-neutral-900 shadow-[inset_0_2px_8px_rgba(0,0,0,0.8)]">
                                        </div>

                                        <!-- Position Markers (8 positions) -->
                                        <button onclick="setHoldCondition('STABLE', 0, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="top: 4%; left: 50%; transform: translateX(-50%);"
                                            title="Stable"></button>
                                        <button onclick="setHoldCondition('BREATH', 45, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="top: 15%; right: 15%;" title="Breath"></button>
                                        <button onclick="setHoldCondition('WIND SHIFT', 90, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="top: 50%; right: 4%; transform: translateY(-50%);"
                                            title="Wind Shift"></button>
                                        <button onclick="setHoldCondition('TRIGGER PULL', 135, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="bottom: 15%; right: 15%;" title="Trigger Pull"></button>
                                        <button onclick="setHoldCondition('MUSCLE TENSION', 180, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="bottom: 4%; left: 50%; transform: translateX(-50%);"
                                            title="Muscle Tension"></button>
                                        <button onclick="setHoldCondition('POSITION SHIFT', 225, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="bottom: 15%; left: 15%;" title="Position Shift"></button>
                                        <button onclick="setHoldCondition('EQUIPMENT', 270, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="top: 50%; left: 4%; transform: translateY(-50%);"
                                            title="Equipment"></button>
                                        <button onclick="setHoldCondition('FATIGUE', 315, this)"
                                            class="absolute w-3 h-3 rounded-full bg-gray-600 border border-gray-500 hover:bg-neon-green hover:border-neon-green transition-all duration-200 shadow-lg"
                                            style="top: 15%; left: 15%;" title="Fatigue"></button>

                                        <!-- Center Dial Indicator -->
                                        <div id="dial-indicator"
                                            class="absolute w-16 h-16 flex items-center justify-center transition-transform duration-500 ease-out"
                                            style="transform: rotate(0deg);">
                                            <div class="w-1 h-8 bg-neon-green rounded-full shadow-[0_0_8px_rgba(34,197,94,0.8)]"
                                                style="transform-origin: center bottom; margin-bottom: 8px;"></div>
                                        </div>

                                        <!-- Center Cap -->
                                        <div
                                            class="absolute w-6 h-6 rounded-full bg-gray-800 border-2 border-gray-600 shadow-[0_0_10px_rgba(0,0,0,0.5)]">
                                        </div>
                                    </div>

                                    <span id="hold-condition-label"
                                        class="text-[11px] font-black text-gray-500 uppercase tracking-widest transition-colors duration-300">Select
                                        Condition</span>

                                    <!-- Analysis Result Container -->
                                    <div id="hold-analysis-result"
                                        class="text-[10px] font-mono whitespace-pre-wrap text-center text-blue-400">
                                    </div>
                                </div>

                                <label for="hold-value" class="sr-only">Hold Notes</label>
                                <input type="text" id="hold-value" class="input-field" placeholder="Hold Notes">
                                <!-- Hidden fields for state -->
                                <input type="hidden" id="hold-grade">
                            </div>

                            <!-- Distance Data Section -->
                            <section class="space-y-4 pt-4 border-t border-gray-800/50">
                                <span class="section-label group flex items-center gap-2 cursor-pointer"
                                    onclick="document.getElementById('distanceForm').classList.toggle('hidden')">
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                    Distance Data (100 - 1000)
                                </span>
                                <div id="distanceForm" class="hidden space-y-2">
                                    <div
                                        class="grid grid-cols-3 gap-2 text-[8px] font-bold text-gray-600 uppercase mb-2 px-1">
                                        <div>Dist</div>
                                        <div>Clicks</div>
                                        <div>UD-LR</div>
                                    </div>
                                    <div class="space-y-1 max-h-60 overflow-y-auto custom-scrollbar pr-2">
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-100" class="sr-only">Distance 100</label><input type="text"
                                                id="dist-100" class="input-field py-1 text-center" placeholder="100">
                                            <label for="clicks-100" class="sr-only">Clicks at 100</label><input
                                                type="text" id="clicks-100" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-100" class="sr-only">UDLR at 100</label><input type="text"
                                                id="udlr-100" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-200" class="sr-only">Distance 200</label><input type="text"
                                                id="dist-200" class="input-field py-1 text-center" placeholder="200">
                                            <label for="clicks-200" class="sr-only">Clicks at 200</label><input
                                                type="text" id="clicks-200" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-200" class="sr-only">UDLR at 200</label><input type="text"
                                                id="udlr-200" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-300" class="sr-only">Distance 300</label><input type="text"
                                                id="dist-300" class="input-field py-1 text-center" placeholder="300">
                                            <label for="clicks-300" class="sr-only">Clicks at 300</label><input
                                                type="text" id="clicks-300" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-300" class="sr-only">UDLR at 300</label><input type="text"
                                                id="udlr-300" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-400" class="sr-only">Distance 400</label><input type="text"
                                                id="dist-400" class="input-field py-1 text-center" placeholder="400">
                                            <label for="clicks-400" class="sr-only">Clicks at 400</label><input
                                                type="text" id="clicks-400" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-400" class="sr-only">UDLR at 400</label><input type="text"
                                                id="udlr-400" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-500" class="sr-only">Distance 500</label><input type="text"
                                                id="dist-500" class="input-field py-1 text-center" placeholder="500">
                                            <label for="clicks-500" class="sr-only">Clicks at 500</label><input
                                                type="text" id="clicks-500" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-500" class="sr-only">UDLR at 500</label><input type="text"
                                                id="udlr-500" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-600" class="sr-only">Distance 600</label><input type="text"
                                                id="dist-600" class="input-field py-1 text-center" placeholder="600">
                                            <label for="clicks-600" class="sr-only">Clicks at 600</label><input
                                                type="text" id="clicks-600" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-600" class="sr-only">UDLR at 600</label><input type="text"
                                                id="udlr-600" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-700" class="sr-only">Distance 700</label><input type="text"
                                                id="dist-700" class="input-field py-1 text-center" placeholder="700">
                                            <label for="clicks-700" class="sr-only">Clicks at 700</label><input
                                                type="text" id="clicks-700" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-700" class="sr-only">UDLR at 700</label><input type="text"
                                                id="udlr-700" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-800" class="sr-only">Distance 800</label><input type="text"
                                                id="dist-800" class="input-field py-1 text-center" placeholder="800">
                                            <label for="clicks-800" class="sr-only">Clicks at 800</label><input
                                                type="text" id="clicks-800" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-800" class="sr-only">UDLR at 800</label><input type="text"
                                                id="udlr-800" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-900" class="sr-only">Distance 900</label><input type="text"
                                                id="dist-900" class="input-field py-1 text-center" placeholder="900">
                                            <label for="clicks-900" class="sr-only">Clicks at 900</label><input
                                                type="text" id="clicks-900" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-900" class="sr-only">UDLR at 900</label><input type="text"
                                                id="udlr-900" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 items-center bg-gray-800/20 p-1 rounded">
                                            <label for="dist-1000" class="sr-only">Distance 1000</label><input
                                                type="text" id="dist-1000" class="input-field py-1 text-center"
                                                placeholder="1000">
                                            <label for="clicks-1000" class="sr-only">Clicks at 1000</label><input
                                                type="text" id="clicks-1000" class="input-field py-1"
                                                placeholder="Clicks">
                                            <label for="udlr-1000" class="sr-only">UDLR at 1000</label><input
                                                type="text" id="udlr-1000" class="input-field py-1" placeholder="UDLR">
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Session Timer Section -->
                            <div class="space-y-3 pt-4 border-t border-gray-800/50">
                                <span class="section-label flex items-center gap-2">
                                    <i data-lucide="timer" class="w-3 h-3 text-blue-400"></i>
                                    Session Timer
                                </span>

                                <!-- Timer Display -->
                                <div class="bg-neutral-800/60 border border-neutral-500 rounded-lg p-4 text-center">
                                    <div class="text-[10px] text-gray-500 uppercase font-bold mb-1">Total Session
                                        Time
                                    </div>
                                    <div id="sessionTimerDisplay" class="text-3xl font-mono font-bold text-blue-400">
                                        00:00:00</div>
                                </div>

                                <!-- Timer Controls -->
                                <div class="grid grid-cols-3 gap-2">
                                    <button id="timerStartBtn"
                                        class="bg-green-900/40 hover:bg-green-900/60 border border-green-500/30 hover:border-green-500 rounded-lg p-2.5 text-sm font-bold text-green-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                        <i data-lucide="play" class="w-4 h-4"></i>
                                        Start
                                    </button>
                                    <button id="timerPauseBtn"
                                        class="bg-yellow-900/40 hover:bg-yellow-900/60 border border-yellow-500/30 hover:border-yellow-500 rounded-lg p-2.5 text-sm font-bold text-yellow-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                        <i data-lucide="pause" class="w-4 h-4"></i>
                                        Pause
                                    </button>
                                    <button id="timerResetBtn"
                                        class="bg-red-900/40 hover:bg-red-900/60 border border-red-500/30 hover:border-red-500 rounded-lg p-2.5 text-sm font-bold text-red-400 hover:text-white flex items-center justify-center gap-2 transition-all">
                                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                                        Reset
                                    </button>
                                </div>
                            </div>

                            <!-- Grade Your Shot Section -->
                            <div class="space-y-4 pt-4 border-t border-gray-800/50">
                                <span class="section-label">Grade Your Shot</span>

                                <div
                                    class="flex flex-col items-center gap-4 bg-black/40 border border-gray-800 p-6 rounded-lg">
                                    <span class="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em]">Impact
                                        Spotter</span>

                                    <!-- Minimalist Target Reticle -->
                                    <div class="relative w-32 h-32 flex items-center justify-center">
                                        <!-- Outer Ring (Re-Engage) -->
                                        <button onclick="setShotGrade('RE-ENGAGE', '#ef4444', this)"
                                            class="absolute w-32 h-32 rounded-full border border-gray-700 hover:border-red-500/50 transition-colors duration-300 group">
                                            <div
                                                class="absolute inset-0 rounded-full opacity-0 group-hover:opacity-10 bg-red-500 transition-opacity">
                                            </div>
                                        </button>

                                        <!-- Inner Ring (Acceptable) -->
                                        <button onclick="setShotGrade('ACCEPTABLE', '#f59e0b', this)"
                                            class="absolute w-20 h-20 rounded-full border border-gray-600 hover:border-amber-500/50 transition-colors duration-300 group z-10">
                                            <div
                                                class="absolute inset-0 rounded-full opacity-0 group-hover:opacity-10 bg-amber-500 transition-opacity">
                                            </div>
                                        </button>

                                        <!-- Center (Match Grade) -->
                                        <button onclick="setShotGrade('MATCH GRADE', '#22c55e', this)"
                                            class="absolute w-8 h-8 rounded-full border-2 border-neon-green/30 hover:border-neon-green transition-colors duration-300 bg-gray-900 z-20 shadow-[0_0_10px_rgba(34,197,94,0.1)] group">
                                            <div
                                                class="absolute inset-0 rounded-full opacity-0 group-hover:opacity-20 bg-neon-green transition-opacity">
                                            </div>
                                        </button>

                                        <!-- Crosshairs -->
                                        <div class="absolute w-full h-[1px] bg-gray-800/50 pointer-events-none">
                                        </div>
                                        <div class="absolute h-full w-[1px] bg-gray-800/50 pointer-events-none">
                                        </div>
                                    </div>

                                    <span id="shot-status-label"
                                        class="text-[11px] font-black text-gray-500 uppercase tracking-widest transition-colors duration-300">Select
                                        Impact Zone</span>

                                    <!-- Analysis Result Container -->
                                    <div id="shot-analysis-result"
                                        class="text-[10px] font-mono whitespace-pre-wrap text-center text-blue-400">
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <label for="shot-grade" class="sr-only">Shot Notes</label>
                                    <input type="text" id="shot-grade" class="input-field" placeholder="Shot Notes">
                                    <!-- Hidden field to store the color and grade name -->
                                    <input type="hidden" id="shot-grade-color">
                                    <input type="hidden" id="shot-grade-name">
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-900 border border-gray-800 rounded-lg p-3 space-y-3">
                            <div class="flex items-center justify-between">
                                <div class="flex gap-4">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="pencil-toggle" class="w-5 h-5 accent-neon-green">
                                        <span class="text-[10px] font-bold uppercase text-gray-400">Pencil</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" id="red-pen-toggle" class="w-5 h-5 accent-red-500">
                                        <span class="text-[10px] font-bold uppercase text-red-500">Red</span>
                                    </label>
                                </div>
                                <button id="clear-pencil"
                                    class="p-1 text-gray-500 hover:text-red-500 transition-colors">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <button id="clear-hold-btn"
                                    class="bg-gray-800 text-[10px] px-3 py-2 rounded font-bold border border-gray-800">CLR
                                    HOLD</button>
                                <button id="clear-shot-btn"
                                    class="bg-gray-800 text-[10px] px-3 py-2 rounded font-bold border border-gray-800">CLR
                                    SHOT</button>
                                <button id="clear-pencil-only-btn"
                                    class="bg-gray-800 text-[10px] px-3 py-2 rounded font-bold border border-gray-800">PENCIL</button>
                                <button id="clear-red-only-btn"
                                    class="bg-gray-800 text-[10px] px-3 py-2 rounded font-bold border border-gray-800">RED</button>
                                <button id="clear-map-pencil-btn"
                                    class="bg-gray-800 text-[10px] px-3 py-2 rounded font-bold border border-gray-800">CLR
                                    MAP</button>
                                <button onclick="analyzeGroup('hold')"
                                    class="bg-blue-900/30 text-[10px] px-3 py-2 rounded font-bold border border-blue-500 text-blue-400">üìä
                                    H</button>
                                <button onclick="analyzeGroup('shot')"
                                    class="bg-blue-900/30 text-[10px] px-3 py-2 rounded font-bold border border-blue-500 text-blue-400">üìä
                                    S</button>
                            </div>
                        </div>
                    </section>



                    <!-- Ballistic Core (Calculator) -->
                    <section class="bg-gray-900 border border-gray-800 rounded p-4 space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="section-label flex items-center gap-2 text-blue-400">
                                <i data-lucide="cpu" class="w-3 h-3"></i> Ballistic Core
                            </span>
                        </div>
                        <label for="calc-display" class="sr-only">Ballistic Calculator Display</label>
                        <input type="text" id="calc-display"
                            class="w-full bg-gray-900 text-right p-3 rounded font-mono text-neon-green text-xl border border-gray-800 mb-2"
                            readonly value="0">
                        <div class="grid grid-cols-4 gap-1">
                            <!-- Row 1: Clear and Ballistic Functions -->
                            <button class="bg-red-900/40 text-red-500 p-2 rounded text-xs font-bold"
                                onclick="clearCalc()">C</button>
                            <button class="bg-purple-900/40 text-purple-300 p-2 rounded text-[9px] font-bold"
                                onclick="moaToMil()">MOA‚ÜíMIL</button>
                            <button class="bg-purple-900/40 text-purple-300 p-2 rounded text-[9px] font-bold"
                                onclick="milToMoa()">MIL‚ÜíMOA</button>
                            <button class="bg-blue-900/40 text-blue-400 p-2 rounded text-[9px] font-bold"
                                onclick="inchToMoa()">IN‚ÜíMOA</button>

                            <!-- Row 2-5: Number pad with operators -->
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('7')">7</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('8')">8</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('9')">9</button>
                            <button class="bg-gray-800 p-2 rounded text-xs" onclick="appendCalc('/')">√∑</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('4')">4</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('5')">5</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('6')">6</button>
                            <button class="bg-gray-800 p-2 rounded text-xs" onclick="appendCalc('*')">√ó</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('1')">1</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('2')">2</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('3')">3</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('-')">-</button>
                            <button class="bg-gray-800 p-2 rounded text-sm col-span-2"
                                onclick="appendCalc('0')">0</button>
                            <button class="bg-gray-800 p-2 rounded text-sm font-bold"
                                onclick="appendCalc('.')">.</button>
                            <button class="bg-gray-800 p-2 rounded text-sm" onclick="appendCalc('+')">+</button>

                            <!-- Row 6: More ballistic functions -->
                            <button class="bg-orange-900/40 text-orange-300 p-2 rounded text-[9px] font-bold"
                                onclick="calcCos()">COS</button>
                            <button class="bg-orange-900/40 text-orange-300 p-2 rounded text-[9px] font-bold"
                                onclick="ydsToMeters()">YD‚ÜíM</button>
                            <button class="bg-orange-900/40 text-orange-300 p-2 rounded text-[9px] font-bold"
                                onclick="metersToYds()">M‚ÜíYD</button>
                            <button
                                class="bg-gray-900 p-2 rounded text-sm border border-neon-green/30 text-neon-green font-bold"
                                onclick="executeCalc()">=</button>
                        </div>
                    </section>

                    <div class="pt-4 space-y-2">
                        <button id="downloadBtn"
                            class="w-full bg-neon-green text-white font-extrabold py-4 rounded-lg hover:shadow-[0_0_20px_rgba(34,197,94,0.4)] transition-all uppercase tracking-widest text-sm flex items-center justify-center gap-3">
                            <i data-lucide="download"></i> Download Card Image
                        </button>
                        <button id="printBtn"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-extrabold py-4 rounded-lg hover:shadow-[0_0_20px_rgba(37,99,235,0.4)] transition-all uppercase tracking-widest text-sm flex items-center justify-center gap-3">
                            <i data-lucide="printer"></i> Print Card
                        </button>
                    </div>

                    <!-- NEW: Mobile Live Preview Sections (Vertical "Screenshots") -->
                    <div id="mobile-live-cards" class="space-y-6 mt-8 border-t border-gray-800 pt-8">

                        <!-- 1. Header Section -->
                        <div class="bg-white text-black p-4 rounded shadow-lg font-mono overflow-hidden">
                            <div class="flex justify-between items-end border-b-2 border-black pb-2 mb-2">
                                <!-- Left: Title & Notes -->
                                <div class="flex flex-col justify-end">
                                    <h2 class="text-2xl font-extrabold uppercase tracking-tighter leading-none mb-1">
                                        Reload Data
                                        <span
                                            class="block text-[10px] text-gray-400 font-mono italic normal-case mt-0.5">ProVersion</span>
                                    </h2>
                                    <div class="text-xs font-bold flex items-center gap-2">
                                        <span>NOTES :</span>
                                        <span id="mobile-display-header-notes"
                                            class="font-handwriting text-blue-800 font-normal truncate max-w-[120px]"></span>
                                    </div>
                                </div>

                                <!-- Right: Shooter Info -->
                                <div class="flex flex-col items-end pb-1">
                                    <span
                                        class="text-[8px] font-bold text-gray-500 uppercase tracking-widest leading-none mb-1">Shooter
                                        / Company</span>
                                    <span id="mobile-display-shooter-company"
                                        class="font-handwriting text-blue-800 font-bold text-sm leading-none text-right"></span>
                                </div>
                            </div>
                        </div>

                        <!-- 2. Data Grid Section -->
                        <div
                            class="bg-white text-black p-4 rounded shadow-lg font-mono text-xs font-bold overflow-hidden">
                            <div class="grid grid-cols-[1.4fr_0.8fr_0.8fr] gap-x-2 gap-y-1">
                                <div class="flex flex-col">
                                    <span class="text-[8px] text-gray-500 uppercase">Timestamp</span>
                                    <div class="flex gap-1 min-h-[1rem]">
                                        <span id="mobile-display-date" class="text-blue-800 font-normal"></span>
                                        <span class="text-gray-400">@</span>
                                        <span id="mobile-display-time" class="text-blue-800 font-normal"></span>
                                    </div>
                                </div>
                                <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Zero
                                        Range</span><span id="mobile-display-zero"
                                        class="text-blue-800 font-normal"></span>
                                </div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Caliber</span><span
                                        id="mobile-display-caliber" class="text-blue-800 font-normal"></span></div>

                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Bullet</span><span
                                        id="mobile-display-bullet" class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Barrel</span><span
                                        id="mobile-display-barrel" class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Powder</span><span
                                        id="mobile-display-powder" class="text-blue-800 font-normal"></span></div>

                                <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Load
                                        (gr)</span><span id="mobile-display-load"
                                        class="text-blue-800 font-normal"></span>
                                </div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">C.O.L</span><span
                                        id="mobile-display-col" class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Rings</span><span
                                        id="mobile-display-rings" class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Primer</span><span
                                        id="mobile-display-primer" class="text-blue-800 font-normal"></span></div>

                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Velocity</span><span
                                        id="mobile-display-velocity" class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col"><span
                                        class="text-[8px] text-gray-500 uppercase">Target</span><span
                                        id="mobile-display-targetSize" class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">G-1
                                        BC</span><span id="mobile-display-g1" class="text-blue-800 font-normal"></span>
                                </div>

                                <div class="flex flex-col col-span-3"><span
                                        class="text-[8px] text-gray-500 uppercase">Environment</span><span
                                        id="mobile-display-environment-summary"
                                        class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col col-span-3"><span
                                        class="text-[8px] text-gray-500 uppercase">Weather Details
                                        (Temp/Hum/Pres/Cos)</span><span id="mobile-display-weather-summary"
                                        class="text-blue-800 font-normal"></span></div>
                                <div class="flex flex-col col-span-3"><span
                                        class="text-[8px] text-gray-500 uppercase">Group</span><span
                                        id="mobile-display-groupSize" class="text-blue-800 font-normal"></span></div>
                            </div>
                        </div>

                        <!-- 3. Observations & Equipment (Icons + Elev Box) -->
                        <div
                            class="bg-white text-black p-4 rounded shadow-lg font-mono overflow-hidden flex flex-col gap-4">
                            <!-- Elev Box -->
                            <div
                                class="grid grid-cols-2 gap-4 bg-gray-50 p-2 border border-black rounded-sm text-xs font-bold">
                                <div class="flex justify-between"><span>ELEV:</span> <span id="mobile-display-elevation"
                                        class="text-blue-800"></span></div>
                                <div class="flex justify-between"><span>HOLD:</span> <span id="mobile-display-hold-data"
                                        class="text-blue-800"></span></div>
                                <div
                                    class="col-span-2 flex justify-between items-center bg-gray-900 text-white px-2 py-1 mt-1">
                                    <span class="text-[10px] font-bold text-neon-green">FINAL DOPE:</span>
                                    <span id="mobile-display-final-dope" class="text-sm font-bold"></span>
                                </div>
                            </div>

                            <!-- Icons List -->
                            <div class="flex flex-col gap-2">
                                <div class="flex items-center gap-2 border border-black p-1">
                                    <img src="https://img.icons8.com/ios-filled/50/000000/sniper-rifle.png" alt="Rifle"
                                        class="w-4 h-4 opacity-40">
                                    <span id="mobile-display-rifle-notes" class="text-[10px]"></span>
                                </div>
                                <div class="flex items-center gap-2 border border-black p-1">
                                    <i data-lucide="crosshair" class="w-3 h-3 text-gray-400"></i>
                                    <span id="mobile-display-scope-notes" class="text-[10px]"></span>
                                </div>
                                <div class="flex items-center gap-2 border border-black p-1">
                                    <i data-lucide="binoculars" class="w-3 h-3 text-gray-400"></i>
                                    <span id="mobile-display-lrf-notes" class="text-[10px]"></span>
                                </div>
                                <div class="flex items-center gap-2 border border-black p-1">
                                    <i data-lucide="wind" class="w-3 h-3 text-gray-400"></i>
                                    <span id="mobile-display-wind-notes" class="text-[10px]"></span>
                                </div>
                                <div class="flex items-center gap-2 border border-black p-1">
                                    <i data-lucide="compass" class="w-3 h-3 text-gray-400"></i>
                                    <span id="mobile-display-compass-range" class="text-[10px]"></span>
                                </div>
                            </div>
                        </div>

                        <!-- 4. Reticles (Hold / Shot) -->
                        <div class="bg-white text-black p-4 rounded shadow-lg font-mono overflow-hidden">
                            <div class="flex gap-4 justify-center">
                                <div class="text-center flex-1">
                                    <p class="text-[10px] font-bold mb-1">HOLD</p>
                                    <canvas id="mobile-canvas-hold" width="250" height="250"
                                        class="border border-black rounded-full bg-white touch-none cursor-crosshair w-full h-auto max-w-[280px] mx-auto"></canvas>
                                </div>
                                <div class="text-center flex-1">
                                    <p class="text-[10px] font-bold mb-1">SHOT</p>
                                    <canvas id="mobile-canvas-shot" width="250" height="250"
                                        class="border border-black rounded-full bg-white touch-none cursor-crosshair w-full h-auto max-w-[280px] mx-auto"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- 5. Footer (Table + Compass) -->
                        <div
                            class="bg-white text-black p-4 rounded shadow-lg font-mono overflow-hidden flex flex-col gap-4">
                            <!-- Table -->
                            <div class="border-2 border-black flex flex-col">
                                <div
                                    class="grid grid-cols-4 bg-gray-900 text-white font-bold text-center text-[10px] py-1">
                                    <div class="border-r border-gray-600">CLICKS</div>
                                    <div class="col-span-2 border-r border-gray-600">RANGE</div>
                                    <div>UD-LR</div>
                                </div>
                                <div id="mobile-distance-table-body" class="flex-col text-[10px] font-bold">
                                    <!-- Injected by script -->
                                </div>
                            </div>

                            <!-- Compass -->
                            <div
                                class="relative border-2 border-black bg-gray-50/50 h-80 overflow-hidden transition-all duration-500">

                                <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
                                    <div
                                        class="w-32 h-32 border border-gray-200 rounded-full flex items-center justify-center">
                                        <p class="font-bold text-gray-300 tracking-widest text-[10px]">YOU</p>
                                    </div>
                                </div>
                                <span class="absolute top-1 left-1/2 -translate-x-1/2 font-bold text-[8px]">N 0¬∞</span>
                                <span class="absolute right-1 top-1/2 -translate-y-1/2 font-bold text-[8px]">E
                                    90¬∞</span>
                                <span class="absolute left-1 top-1/2 -translate-y-1/2 font-bold text-[8px]">W
                                    270¬∞</span>
                                <span class="absolute bottom-1 left-1/2 -translate-x-1/2 font-bold text-[8px]">S
                                    180¬∞</span>

                                <canvas id="mobile-compass-vector" width="300" height="300"
                                    class="absolute inset-0 w-full h-full pointer-events-none z-10"></canvas>
                                <canvas id="mobile-pencil-canvas" width="300" height="300"
                                    class="absolute inset-0 w-full h-full cursor-crosshair z-20"></canvas>

                                <!-- Watermark -->
                                <div
                                    class="absolute bottom-1 right-2 font-serif italic text-[10px] uppercase tracking-widest opacity-30 pointer-events-none pointer-events-none z-0">
                                    Range Card v1.0
                                </div>

                                <!-- Mobile Compass Details (DIR/ANG) -->
                                <div
                                    class="absolute top-1 left-1 z-30 pointer-events-none space-y-0.5 bg-white/40 p-1 rounded-sm">
                                    <div class="flex items-center gap-1 font-bold text-[8px]">
                                        <span>DIR:</span>
                                        <div
                                            class="flex-1 max-w-[100px] border-b border-black text-center min-h-[10px] overflow-hidden whitespace-nowrap text-ellipsis">
                                            <span id="mobile-display-direction-notes" class="text-blue-800"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1 font-bold text-[8px]">
                                        <span>T1 Shot:</span>
                                        <div
                                            class="flex-1 max-w-[100px] border-b border-black text-center min-h-[10px] overflow-hidden whitespace-nowrap text-ellipsis">
                                            <span id="mobile-display-shooting-angle" class="text-blue-800"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1 font-bold text-[8px]">
                                        <span>T2 Shot:</span>
                                        <div
                                            class="flex-1 max-w-[100px] border-b border-black text-center min-h-[10px] overflow-hidden whitespace-nowrap text-ellipsis">
                                            <span id="mobile-display-shooting-angle-2" class="text-blue-800"></span>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1 font-bold text-[8px]">
                                        <span>T3 Shot:</span>
                                        <div
                                            class="flex-1 max-w-[100px] border-b border-black text-center min-h-[10px] overflow-hidden whitespace-nowrap text-ellipsis">
                                            <span id="mobile-display-shooting-angle-3" class="text-blue-800"></span>
                                        </div>
                                    </div>


                                </div>


                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-[10px] text-center text-gray-600 font-mono pb-8">
                    &copy; 2026 Ralph Mccabe. All Rights Reserved.
                </div>
            </div>
        </aside>

        <!-- RIGHT PANEL: PREVIEW -->
        <main id="previewPanel"
            class="hidden lg:flex flex-col flex-1 bg-neutral-700 overflow-y-auto p-4 lg:p-10 items-center justify-start lg:justify-center relative bg-grid-pattern transition-all duration-300 min-h-[500px]">

            <!-- Mobile Preview Header -->
            <!-- Mobile Preview Header -->
            <div class="w-full mb-6 lg:hidden shrink-0 flex justify-center pt-4 border-b border-gray-800 pb-4">
                <p class="text-[10px] text-gray-500 font-mono italic">
                    &copy; 2026 Ralph Mccabe. All Rights Reserved.
                </p>
            </div>

            <div id="card-scale-wrapper" class="w-full flex flex-col items-center py-8 lg:py-0 flex-1 justify-center">
                <div id="card-container"
                    class="bg-white text-black w-[1000px] aspect-[4/3] shadow-2xl relative p-8 flex flex-col font-mono shrink-0 origin-top lg:origin-center">

                    <!-- Image Overlay for Imported Cards -->
                    <img id="cardImageOverlay" src=""
                        class="absolute inset-0 w-full h-full object-contain z-50 hidden bg-white">

                    <!-- Card Header -->
                    <div class="flex justify-between items-center gap-8 mb-6 border-b-2 border-black pb-2">
                        <div class="flex items-center gap-8">
                            <h2 class="text-4xl font-extrabold uppercase tracking-tighter flex flex-col leading-none">
                                Reload Data
                                <span class="text-xs text-gray-400 font-mono italic normal-case mt-1">ProVersion</span>
                            </h2>
                            <div class="text-xl font-bold flex items-center gap-2">
                                <span>NOTES :</span>
                                <span id="display-header-notes"
                                    class="font-handwriting text-blue-800 font-normal"></span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-gray-500 uppercase font-bold">Shooter / Company</div>
                            <div id="display-shooter-company" class="text-sm font-bold text-black"></div>
                        </div>
                    </div>

                    <!-- Main Grid -->
                    <div class="flex gap-4 h-[40%]">
                        <!-- Column 1: Load Details -->
                        <div
                            class="w-[40%] grid grid-cols-[1.4fr_0.8fr_0.8fr] gap-x-2 gap-y-1 text-[10px] font-bold content-start">
                            <div class="flex flex-col">
                                <span class="text-[8px] text-gray-500 uppercase">Timestamp</span>
                                <div class="flex gap-1 min-h-[1.2rem]">
                                    <span id="display-date" class="text-blue-800 font-normal"></span>
                                    <span class="text-gray-400">@</span>
                                    <span id="display-time" class="text-blue-800 font-normal"></span>
                                </div>
                            </div>
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Zero
                                    Range</span><span id="display-zero" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Caliber</span><span id="display-caliber"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Bullet</span><span id="display-bullet"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Barrel</span><span id="display-barrel"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Powder</span><span id="display-powder"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Load
                                    (gr)</span><span id="display-load" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">C.O.L</span><span id="display-col"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Rings</span><span id="display-rings"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Primer</span><span id="display-primer"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Velocity</span><span
                                    id="display-velocity" class="text-blue-800 font-normal"></span>
                            </div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Target</span><span
                                    id="display-targetSize" class="text-blue-800 font-normal"></span>
                            </div>
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">G-1
                                    BC</span><span id="display-g1" class="text-blue-800 font-normal"></span></div>
                            <!-- Structured Weather Display -->
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Env</span><span
                                    id="display-environment-summary" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Temp</span><span
                                    id="display-temperature" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Humidity</span><span
                                    id="display-humidity" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Pressure</span><span
                                    id="display-pressure" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Wind</span><span
                                    id="display-wind-speed" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Cosine</span><span id="display-cosine"
                                    class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span class="text-[8px] text-gray-500 uppercase">Misc</span><span
                                    id="display-misc" class="text-blue-800 font-normal"></span></div>
                            <div class="flex flex-col"><span
                                    class="text-[8px] text-gray-500 uppercase">Group</span><span id="display-groupSize"
                                    class="text-blue-800 font-normal"></span>
                            </div>

                            <div
                                class="col-span-3 mt-2 grid grid-cols-2 gap-4 bg-gray-50 p-2 border border-black rounded-sm">
                                <div class="flex justify-between"><span>ELEV:</span> <span id="display-elevation"
                                        class="text-blue-800 font-bold"></span>
                                </div>
                                <div class="flex justify-between"><span>HOLD:</span> <span id="display-hold-data"
                                        class="text-blue-800 font-bold"></span>
                                </div>
                                <div
                                    class="col-span-2 flex justify-between items-center bg-black text-white px-2 py-1 mt-1">
                                    <span class="text-[10px] font-bold text-neon-green">FINAL
                                        DOPE:</span>
                                    <span id="display-final-dope" class="text-lg font-bold"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Column 2: Equipment Icons -->
                        <div class="w-[20%] flex flex-col gap-2">
                            <div class="item-note flex items-center gap-2 border border-black p-1 min-h-[2.5rem]">
                                <img src="https://img.icons8.com/ios-filled/50/000000/sniper-rifle.png" alt="Rifle"
                                    class="w-5 h-5 opacity-40">
                                <span id="display-rifle-notes" class="text-[10px]"></span>
                            </div>
                            <div class="item-note flex items-center gap-2 border border-black p-1 min-h-[2.5rem]">
                                <i data-lucide="crosshair" class="w-4 h-4 text-gray-400"></i> <span
                                    id="display-scope-notes" class="text-[10px]"></span>
                            </div>
                            <div class="item-note flex items-center gap-2 border border-black p-1 min-h-[2.5rem]">
                                <i data-lucide="binoculars" class="w-4 h-4 text-gray-400"></i> <span
                                    id="display-lrf-notes" class="text-[10px]"></span>
                            </div>
                            <div class="item-note flex items-center gap-2 border border-black p-1 min-h-[2.5rem]">
                                <i data-lucide="wind" class="w-4 h-4 text-gray-400"></i> <span id="display-wind-notes"
                                    class="text-[10px]"></span>
                            </div>
                            <div class="item-note flex items-center gap-2 border border-black p-1 min-h-[2.5rem]">
                                <i data-lucide="compass" class="w-4 h-4 text-gray-400"></i> <span
                                    id="display-compass-range" class="text-[10px]"></span>
                            </div>
                        </div>

                        <!-- Column 3: Reticles -->
                        <div class="flex-1 flex gap-2">
                            <div class="flex-1 text-center">
                                <p class="text-[10px] font-bold mb-1">HOLD</p>
                                <canvas id="canvas-hold" width="250" height="250"
                                    class="border border-black rounded-full bg-white touch-none cursor-crosshair w-full h-auto max-w-[280px] mx-auto"></canvas>
                                <div class="mt-1 text-[10px] font-bold">
                                    <span>H-NOTE:</span>

                                    <span id="display-hold-value"
                                        class="text-blue-800 font-normal font-handwriting"></span>
                                </div>
                            </div>
                            <div class="flex-1 text-center">
                                <p class="text-[10px] font-bold mb-1">SHOT</p>
                                <canvas id="canvas-shot" width="250" height="250"
                                    class="border border-black rounded-full bg-white touch-none cursor-crosshair w-full h-auto max-w-[280px] mx-auto"></canvas>
                                <div class="mt-1 text-[10px] font-bold">
                                    <span>S-NOTE:</span>
                                    <span id="display-shot-grade"
                                        class="text-blue-800 font-normal font-handwriting"></span>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Bottom Grid -->
                    <div class="flex-1 flex gap-4 mt-8 overflow-hidden">
                        <!-- Range Table -->
                        <div class="w-[22%] border-2 border-black flex flex-col overflow-hidden">
                            <div class="grid grid-cols-4 bg-black text-white font-bold text-center text-[10px] py-1">
                                <div class="border-r border-gray-600">CLICKS</div>
                                <div class="col-span-2 border-r border-gray-600">RANGE</div>
                                <div>UD-LR</div>
                            </div>
                            <div id="distance-table-body" class="flex-1 flex flex-col text-[10px] font-bold">
                                <!-- Injected by script -->
                            </div>
                        </div>

                        <!-- Compass -->
                        <div class="flex-1 relative border border-black bg-gray-50/50 m-3 overflow-hidden">
                            <span class="absolute top-1 left-1/2 -translate-x-1/2 font-bold text-[10px]">N
                                0¬∞</span>
                            <span
                                class="absolute right-1 top-1/2 -translate-y-1/2 font-bold text-[10px] flex gap-1 items-center">90¬∞
                                E</span>
                            <span
                                class="absolute left-1 top-1/2 -translate-y-1/2 font-bold text-[10px] flex gap-1 items-center">W
                                270¬∞</span>
                            <span class="absolute bottom-1 left-1/2 -translate-x-1/2 font-bold text-[10px]">S
                                180¬∞</span>

                            <div
                                class="absolute top-1 left-1 z-30 pointer-events-none space-y-1 max-w-[90%] bg-white/40 p-1 rounded-sm">
                                <div class="flex items-center gap-1 font-bold text-[9px]">
                                    <span class="shrink-0 leading-none">DIR:</span>
                                    <div class="min-w-[2rem] border-b border-black/30 text-center min-h-[12px]">
                                        <span id="display-direction-notes" class="text-blue-800"></span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-1 font-bold text-[9px]">
                                    <span class="shrink-0 leading-none">T1 Shot:</span>
                                    <div class="min-w-[2rem] border-b border-black/30 text-center min-h-[12px]">
                                        <span id="display-shooting-angle" class="text-blue-800"></span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-1 font-bold text-[9px]">
                                    <span class="shrink-0 leading-none">T2 Shot:</span>
                                    <div class="min-w-[2rem] border-b border-black/30 text-center min-h-[12px]">
                                        <span id="display-shooting-angle-2" class="text-blue-800"></span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-1 font-bold text-[9px]">
                                    <span class="shrink-0 leading-none">T3 Shot:</span>
                                    <div class="min-w-[2rem] border-b border-black/30 text-center min-h-[12px]">
                                        <span id="display-shooting-angle-3" class="text-blue-800"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
                                <div
                                    class="w-32 h-32 border border-gray-200 rounded-full flex items-center justify-center">
                                    <p class="font-bold text-gray-300 tracking-widest">YOU</p>
                                </div>
                            </div>
                            <canvas id="compass-vector" width="300" height="300"
                                class="absolute inset-0 w-full h-full pointer-events-none z-10"></canvas>
                            <canvas id="pencil-canvas" width="300" height="300"
                                class="absolute inset-0 w-full h-full cursor-crosshair z-20"></canvas>
                        </div>
                    </div>

                    <div class="absolute bottom-2 right-4 font-serif italic text-xl tracking-widest opacity-20">
                        RANGE
                        CARD
                        v1.0</div>


                </div>
            </div>
        </main>

        <!-- PRINT SIZE SELECTION MODAL -->
        <div id="printSizeModal"
            class="fixed inset-0 bg-black/95 backdrop-blur-md z-[210] hidden flex items-center justify-center p-4">
            <div
                class="bg-neutral-800 border border-neutral-500 w-full max-w-md rounded-xl shadow-[0_0_100px_rgba(37,99,235,0.2)] p-6">
                <div class="flex items-center gap-3 mb-6">
                    <i data-lucide="printer" class="w-6 h-6 text-blue-400"></i>
                    <h2 class="text-xl font-bold uppercase tracking-tight text-[var(--text-primary)]">Select Print Size
                    </h2>
                </div>

                <div class=" space-y-3">
                    <button onclick="printCard('letter-landscape')"
                        class="w-full bg-gray-800 hover:bg-gray-700 border border-gray-600 hover:border-blue-500 rounded-lg p-4 text-left transition-all group">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-bold text-white group-hover:text-blue-400">Letter Landscape</div>
                                <div class="text-xs text-gray-400 mt-1">8.5" √ó 11" (Horizontal) ‚Ä¢ Best for
                                    readability
                                </div>
                            </div>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600 group-hover:text-blue-400"></i>
                        </div>
                    </button>

                    <button onclick="printCard('half-letter')"
                        class="w-full bg-gray-800 hover:bg-gray-700 border border-gray-600 hover:border-blue-500 rounded-lg p-4 text-left transition-all group">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-bold text-white group-hover:text-blue-400">Half Letter</div>
                                <div class="text-xs text-gray-400 mt-1">5.5" √ó 8.5" ‚Ä¢ Compact, fits 2 per page</div>
                            </div>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600 group-hover:text-blue-400"></i>
                        </div>
                    </button>

                    <button onclick="printCard('index-card')"
                        class="w-full bg-gray-800 hover:bg-gray-700 border border-gray-600 hover:border-blue-500 rounded-lg p-4 text-left transition-all group">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-bold text-white group-hover:text-blue-400">Index Card</div>
                                <div class="text-xs text-gray-400 mt-1">4" √ó 6" ‚Ä¢ Ultra-portable field card</div>
                            </div>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-600 group-hover:text-blue-400"></i>
                        </div>
                    </button>
                </div>

                <button onclick="closePrintModal()"
                    class="w-full mt-6 bg-neutral-700 hover:bg-neutral-600 border border-neutral-500 rounded-lg p-3 text-sm font-bold text-gray-400 hover:text-white transition-all">
                    Cancel
                </button>
            </div>
        </div>

        <!-- LIBRARY MODAL -->
        <div id="libraryModal"
            class="fixed inset-0 bg-black/95 backdrop-blur-md z-[300] hidden flex items-center justify-center p-4">
            <div
                class="bg-neutral-700 border border-neutral-500 w-full max-w-5xl h-[90vh] rounded-xl shadow-[0_0_100px_rgba(34,197,94,0.1)] flex flex-col overflow-hidden">
                <!-- Header -->
                <div
                    class="p-4 border-b border-neutral-500 flex justify-between items-center bg-neutral-600/30 shrink-0">
                    <div class="flex items-center gap-3">
                        <i data-lucide="database" class="w-5 h-5 text-neon-green"></i>
                        <div>
                            <h2 class="text-lg font-bold uppercase tracking-tight leading-none text-white">
                                Profile
                                Repository</h2>
                            <span class="text-[9px] text-gray-500 font-mono uppercase">Local Storage
                                Records</span>
                        </div>
                    </div>
                    <button id="closeLibraryBtn" class="p-2 hover:bg-gray-800 rounded-lg group transition-all">
                        <i data-lucide="x" class="w-6 h-6 text-gray-500 group-hover:text-white transition-colors"></i>
                    </button>
                </div>

                <!-- Content Area -->
                <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
                    <!-- Sidebar List -->
                    <div id="librarySidebar"
                        class="w-full lg:w-80 border-b lg:border-b-0 lg:border-r border-neutral-500 flex flex-col bg-neutral-800/20 shrink-0 h-1/3 lg:h-full">
                        <div class="p-4 border-b border-neutral-500 bg-neutral-900/20">
                            <p class="text-[10px] font-bold text-gray-600 uppercase tracking-widest">Saved
                                Profiles</p>
                        </div>
                        <div id="libraryList" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1">
                            <!-- Profiles list here -->
                        </div>
                    </div>

                    <!-- Preview Pane -->
                    <div class="flex-1 flex flex-col relative bg-neutral-800">
                        <!-- Empty State -->
                        <div id="noSelection"
                            class="absolute inset-0 flex flex-col items-center justify-center text-center p-12">
                            <i data-lucide="layout-template" class="w-16 h-16 text-gray-800 mb-4 stroke-1"></i>
                            <p class="text-gray-600 font-mono text-xs uppercase tracking-[0.3em]">Load a
                                specific record to
                                view details</p>
                        </div>

                        <div id="profilePreview" class="absolute inset-0 flex flex-col hidden z-10">
                            <!-- Profile Header area -->
                            <div
                                class="p-5 bg-gray-900/60 border-b border-gray-800 flex justify-between items-center shrink-0">
                                <div class="flex items-center gap-4 min-w-0">
                                    <!-- Mobile Back Button -->
                                    <button onclick="window.closeProfilePreview()"
                                        class="lg:hidden p-2 bg-neutral-800 border border-neutral-600 rounded-lg text-white">
                                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                    </button>
                                    <div class="min-w-0">
                                        <h3 id="previewName"
                                            class="text-2xl font-black text-white uppercase truncate leading-none mb-1">
                                            ---</h3>
                                        <p id="previewCaliber"
                                            class="text-neon-green font-mono text-[10px] uppercase truncate tracking-wide">
                                            ---
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4 shrink-0">
                                    <div class="flex bg-black/80 rounded border border-gray-700 p-0.5">
                                        <button id="viewImageBtn"
                                            class="px-4 py-1.5 text-[10px] font-bold uppercase rounded transition-all">Report</button>
                                        <button id="viewDataBtn"
                                            class="px-4 py-1.5 text-[10px] font-bold uppercase rounded transition-all">Data</button>
                                    </div>
                                    <div class="text-right border-l border-gray-800 pl-4">
                                        <p class="text-[8px] text-gray-500 font-bold uppercase">Record Date
                                        </p>
                                        <p id="prevDate" class="text-xs text-gray-400 font-mono italic leading-none">---
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Main Screen Area -->
                            <div class="flex-1 relative overflow-hidden bg-[var(--input-bg)]/40">
                                <!-- Visual Snapshot -->
                                <div id="snapshotPreview"
                                    class="absolute inset-0 overflow-auto custom-scrollbar p-10 flex flex-col items-center">
                                    <div id="noImageMsg" class="mt-20 text-gray-700 font-mono text-xs uppercase hidden">
                                        No
                                        visual snapshot saved</div>
                                    <img id="prevImage" src=""
                                        class="shadow-2xl border border-gray-700 bg-white max-w-full">
                                </div>

                                <!-- Data Grid View -->
                                <div id="dataPreview"
                                    class="absolute inset-0 overflow-y-auto custom-scrollbar hidden p-10 bg-gray-900">
                                    <div class="max-w-3xl mx-auto space-y-10">
                                        <div class="border-b border-gray-800 pb-2">
                                            <span
                                                class="text-[10px] text-neon-green font-bold uppercase mb-2 block">Header
                                                Information</span>
                                            <p id="prevHeaderNotes"
                                                class="text-sm text-gray-300 italic leading-relaxed">---
                                            </p>
                                        </div>

                                        <div class="grid grid-cols-3 gap-8">
                                            <div class="border-l border-gray-700 pl-3">
                                                <p class="text-[9px] text-gray-500 uppercase font-bold">
                                                    Velocity</p>
                                                <p id="prevVel" class="text-xl font-mono text-blue-400 font-bold mt-1">
                                                    ---
                                                </p>
                                            </div>
                                            <div class="border-l border-gray-700 pl-3">
                                                <p class="text-[9px] text-gray-500 uppercase font-bold">Zero
                                                    Range</p>
                                                <p id="prevZero" class="text-xl font-mono text-blue-400 font-bold mt-1">
                                                    ---
                                                </p>
                                            </div>
                                            <div class="border-l border-gray-700 pl-3">
                                                <p class="text-[9px] text-gray-500 uppercase font-bold text-neon-green">
                                                    Final Dope</p>
                                                <p id="prevFinal"
                                                    class="text-xl font-mono text-neon-green font-bold mt-1">
                                                    ---</p>
                                            </div>
                                        </div>

                                        <!-- Tactical Grid -->
                                        <div
                                            class="grid grid-cols-3 gap-4 bg-[var(--input-bg)]/40 p-4 rounded-lg border border-gray-800">
                                            <div class="space-y-1">
                                                <p class="text-[8px] text-gray-500 uppercase font-bold">
                                                    Timestamp</p>
                                                <p id="prevTime" class="text-xs text-gray-300 font-mono">---
                                                </p>
                                            </div>
                                            <div class="space-y-1">
                                                <p class="text-[8px] text-gray-500 uppercase font-bold">
                                                    Elevation Corr.</p>
                                                <p id="prevElev" class="text-xs text-gray-300 font-mono">---
                                                </p>
                                            </div>
                                            <div class="space-y-1">
                                                <p class="text-[8px] text-gray-500 uppercase font-bold">Hold
                                                    Over</p>
                                                <p id="prevHold" class="text-xs text-gray-300 font-mono">---
                                                </p>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-10">
                                            <div class="space-y-4">
                                                <div class="bg-black/30 p-4 rounded-lg border border-gray-800">
                                                    <p
                                                        class="text-[10px] text-gray-400 font-bold uppercase mb-2 border-b border-gray-800 pb-1">
                                                        Load Specifications</p>
                                                    <div class="space-y-1 text-[11px] font-mono">
                                                        <div class="flex justify-between border-b border-gray-800/30">
                                                            <span>Barrel:</span> <span id="prevBarrel">---</span>
                                                        </div>
                                                        <div class="flex justify-between border-b border-gray-800/30">
                                                            <span>Powder:</span> <span id="prevPowder">---</span>
                                                        </div>
                                                        <div class="flex justify-between border-b border-gray-800/30">
                                                            <span>Charge:</span> <span id="prevLoad">---</span>
                                                        </div>
                                                        <div class="flex justify-between border-b border-gray-800/30">
                                                            <span>C.O.L:</span> <span id="prevCOL">---</span>
                                                        </div>
                                                        <div class="flex justify-between"><span>G1
                                                                BC:</span> <span id="prevG1">---</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="p-2">
                                                    <p class="text-[10px] text-gray-500 uppercase font-bold mb-2">
                                                        Observations</p>
                                                    <p id="prevRifleNotes" class="text-[11px] text-gray-400 italic">---
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="space-y-4">
                                                <div class="bg-black/30 p-4 rounded-lg border border-gray-800">
                                                    <p
                                                        class="text-[10px] text-gray-400 font-bold uppercase mb-2 border-b border-gray-800 pb-1">
                                                        Ballistic Reference</p>
                                                    <div id="prevDistanceTable"
                                                        class="grid grid-cols-2 gap-x-4 gap-y-1 text-[10px] font-mono">
                                                        <!-- Table injected -->
                                                    </div>
                                                </div>
                                                <div class="p-2">
                                                    <p class="text-[10px] text-gray-500 uppercase font-bold mb-2">
                                                        Environment</p>
                                                    <p id="prevWeather" class="text-[11px] text-gray-400 italic">---</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Footer Actions -->
                            <div id="previewActions"
                                class="p-5 bg-black/80 border-t border-gray-800 flex gap-4 shrink-0 mt-auto">
                                <button id="loadSelectedBtn"
                                    class="flex-1 bg-neon-green text-black font-extrabold py-4 rounded-lg hover:bg-green-400 shadow-[0_4px_15px_rgba(34,197,94,0.3)] transition-all uppercase tracking-widest text-xs flex items-center justify-center gap-3 active:translate-y-0.5">
                                    <i data-lucide="upload-cloud" class="w-5 h-5"></i>
                                    Inject into Main Form
                                </button>
                                <button id="deleteSelectedBtn"
                                    class="px-8 bg-red-950/20 hover:bg-red-900 border border-red-900/30 hover:border-red-600 text-red-400 hover:text-white py-4 rounded-lg transition-all text-[11px] font-bold uppercase flex items-center justify-center gap-2 group">
                                    <i data-lucide="trash-2"
                                        class="w-4 h-4 text-red-500 group-hover:text-white transition-colors"></i>
                                    Trash Record
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>



    <!-- AI INTEL HUB MODAL -->
    <div id="intelHubModal"
        class="fixed inset-0 bg-black/95 backdrop-blur-md z-[200] hidden flex items-center justify-center p-0 md:p-4">
        <div
            class="bg-neutral-700 border border-neutral-500 w-full max-w-4xl h-full md:h-[85vh] landscape:h-[95vh] rounded-none md:rounded-xl shadow-[0_0_100px_rgba(37,99,235,0.15)] flex flex-col overflow-hidden">
            <!-- Header -->
            <div class="p-4 border-b border-neutral-500 flex justify-between items-center bg-neutral-600/30 shrink-0">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-[0_0_20px_rgba(37,99,235,0.4)]">
                        <i data-lucide="brain-circuit" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-black uppercase tracking-tighter text-white leading-none">Tactical Intel
                            Hub</h2>
                        <span class="text-[9px] text-blue-500 font-black uppercase tracking-widest">Operator Decision
                            Support</span>
                    </div>
                </div>
                <button onclick="closeIntelHub()" class="p-2 hover:bg-gray-800 rounded-lg transition-all group">
                    <i data-lucide="x" class="w-6 h-6 text-gray-500 group-hover:text-[var(--input-text)]"></i>
                </button>
            </div>

            <!-- Tab Navigation -->
            <div class="flex flex-nowrap border-b border-neutral-500 bg-neutral-800/40 px-4 shrink-0 overflow-x-auto scroll-smooth cursor-grab active:cursor-grabbing custom-scrollbar touch-pan-x"
                style="-webkit-overflow-scrolling: touch;">
                <button onclick="switchIntelTab('ai-advisor')" id="tab-ai-advisor"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-blue-500 text-blue-500 whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="brain" class="w-3.5 h-3.5"></i> AI Advisor
                </button>
                <button onclick="switchIntelTab('connectivity')" id="tab-connectivity"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="signal" class="w-3.5 h-3.5"></i> CONNECTIVITY
                </button>
                <button onclick="switchIntelTab('weather-station')" id="tab-weather-station"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="cloud-sun" class="w-3.5 h-3.5"></i> LIVE WEATHER
                </button>
                <button onclick="switchIntelTab('tactical-compass')" id="tab-tactical-compass"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="compass" class="w-3.5 h-3.5"></i> TACTICAL COMPASS
                </button>
                <button onclick="switchIntelTab('tactical-map')" id="tab-tactical-map"
                    class="hidden px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="map" class="w-3.5 h-3.5"></i> TACTICAL MAP
                </button>
                <button onclick="switchIntelTab('work-center')" id="tab-work-center"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="layout-grid" class="w-3.5 h-3.5"></i> WORK CENTER
                </button>
                <button onclick="switchIntelTab('session-history')" id="tab-session-history"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="history" class="w-3.5 h-3.5"></i> Session History
                </button>
                <button onclick="switchIntelTab('target-cam')" id="tab-target-cam"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="crosshair" class="w-3.5 h-3.5"></i> TARGET CAM
                </button>
                <button onclick="switchIntelTab('vault')" id="tab-vault"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="archive" class="w-3.5 h-3.5"></i> INTEL VAULT
                </button>
                <button onclick="switchIntelTab('scope-cam')" id="tab-scope-cam"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="camera" class="w-3.5 h-3.5"></i> SCOPE CAM
                </button>
                <button onclick="switchIntelTab('field-tape')" id="tab-field-tape"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="film" class="w-3.5 h-3.5"></i> FIELD TAPE
                </button>
                <button onclick="switchIntelTab('ballistic-intel')" id="tab-ballistic-intel"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="target" class="w-3.5 h-3.5"></i> Ballistic Intel
                </button>
                <button onclick="switchIntelTab('gps-rangefinder')" id="tab-gps-rangefinder"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="satellite-dish" class="w-4 h-4"></i> GPS RANGE
                </button>
                <button onclick="switchIntelTab('legal')" id="tab-legal"
                    class="px-6 py-4 text-[10px] font-black uppercase tracking-widest border-b-2 border-transparent text-gray-500 hover:text-[var(--input-text)] transition-all whitespace-nowrap flex-shrink-0 min-w-[120px] flex items-center justify-center gap-2">
                    <i data-lucide="scale" class="w-4 h-4"></i> LEGAL
                </button>


            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-hidden relative">
                <!-- üõ°Ô∏è OPERATOR WORK CENTER (OWC) | 15-WIDGET DASHBOARD -->
                <div id="intel-work-center"
                    class="hidden h-full flex flex-col space-y-4 overflow-y-auto p-4 md:p-6 custom-scrollbar">
                    <div
                        class="flex justify-between items-center bg-blue-900/20 p-2 rounded-lg border border-blue-500/20 mb-2">
                        <div class="flex items-center gap-2">
                            <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></div>
                            <span class="text-[9px] font-black text-blue-200 uppercase tracking-widest">Live Mission
                                Sync</span>
                        </div>
                        <div class="flex gap-1">
                            <button id="owc-unit-toggle-btn" onclick="window.toggleOWCUnits()"
                                class="px-2 py-1 bg-zinc-800 border border-zinc-600 rounded text-[8px] font-black text-blue-400 hover:border-blue-500 transition-all">
                                MODE: MIL
                            </button>
                            <button id="owc-live-sync-btn" onclick="window.toggleOWCLiveSync()"
                                class="px-2 py-1 bg-blue-600 rounded text-[8px] font-black text-white hover:bg-blue-500 transition-colors">
                                LIVE: ON
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 md:grid-cols-5 gap-2">
                        <!-- 1. RIFLE INFRA -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between hover:border-gray-800 transition-colors">
                            <label for="owc-rifle-input"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">01:
                                RIFLE</label>
                            <input type="text" id="owc-rifle-input" placeholder="SYSTEM-1"
                                class="bg-transparent border-none text-[9px] font-black text-[var(--input-text)] w-full focus:outline-none p-0 uppercase"
                                oninput="window.updateOWC()">
                            <span class="text-[6px] text-zinc-600 font-bold uppercase tracking-widest">ID /
                                PROFILE</span>
                        </div>

                        <!-- 2. OPTIC CONTROL -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between">
                            <label for="owc-mag"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">02:
                                OPTIC</label>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-black text-[var(--input-text)]" id="owc-mag-val">12</span>
                                <span class="text-[7px] font-bold text-zinc-600">X</span>
                            </div>
                            <input type="range" id="owc-mag" min="1" max="25" value="12"
                                class="h-1 bg-[var(--input-bg)] rounded-lg appearance-none cursor-pointer accent-blue-500"
                                oninput="document.getElementById('owc-mag-val').textContent=this.value; window.updateOWC()">
                        </div>

                        <!-- 3. AMMO / BC -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between hover:border-gray-800 transition-colors">
                            <label for="owc-ammo-input"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">03:
                                AMMO</label>
                            <input type="text" id="owc-ammo-input" placeholder="308 WIN"
                                class="bg-transparent border-none text-[9px] font-black text-[var(--input-text)] w-full focus:outline-none p-0 uppercase"
                                oninput="window.updateOWC()">
                            <div class="flex items-center gap-1 border-t border-gray-700 pt-1">
                                <label for="owc-bc" class="text-[6px] text-zinc-500 font-bold uppercase">BC:</label>
                                <input type="number" id="owc-bc" value="0.510" step="0.001"
                                    class="bg-transparent border-none text-[8px] font-black text-blue-400 w-12 focus:outline-none p-0"
                                    oninput="window.updateOWC()">
                            </div>
                        </div>

                        <!-- 4. TARGET SIZE -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between">
                            <label for="owc-target-size"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">04:
                                TARGET</label>
                            <input type="number" id="owc-target-size" placeholder="IN"
                                class="bg-transparent border-none text-sm font-black text-[var(--input-text)] w-full focus:outline-none p-0"
                                oninput="window.updateOWC()">
                            <label for="owc-target-size" class="text-[6px] text-zinc-600 font-bold uppercase">SIZE
                                (IN)</label>
                        </div>

                        <!-- 5. ZERO BOX -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between">
                            <label for="owc-zero"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">05:
                                ZERO</label>
                            <input type="number" id="owc-zero" value="100"
                                class="bg-transparent border-none text-sm font-black text-[var(--input-text)] w-full focus:outline-none p-0"
                                oninput="window.updateOWC()">
                            <span class="text-[6px] text-zinc-600 font-bold uppercase">YARDS</span>
                        </div>

                        <!-- 6. PRIMARY RANGE -->
                        <div
                            class="bg-blue-600/10 border border-blue-500/30 p-2 rounded-lg flex flex-col justify-between shadow-lg group">
                            <div class="flex justify-between items-start">
                                <label for="owc-range"
                                    class="text-[7px] font-black text-blue-400 uppercase tracking-tighter mb-1">06:
                                    RANGE</label>
                                <button onclick="window.switchIntelTab('tactical-map'); openIntelHub();"
                                    class="text-[7px] font-black bg-blue-600/20 text-blue-400 px-1.5 py-0.5 rounded border border-blue-500/30 hover:bg-blue-600 hover:text-white transition-all opacity-0 group-hover:opacity-100 uppercase">
                                    BACKUP
                                </button>
                            </div>
                            <input type="number" id="owc-range" placeholder="YDS"
                                class="bg-transparent border-none text-lg font-black text-[var(--input-text)] w-full focus:outline-none p-0"
                                oninput="window.updateOWC()">
                            <label for="owc-range" class="text-[6px] text-blue-600 font-bold uppercase">DISTANCE</label>
                        </div>

                        <!-- 7. LOS HEADING (VECTOR) -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between group">
                            <label for="owc-los-heading"
                                class="text-[7px] font-black text-blue-500 uppercase tracking-tighter mb-1">07: LOS
                                DEG</label>
                            <div class="flex items-center gap-1">
                                <input type="number" id="owc-los-heading" value="0" min="0" max="359"
                                    class="bg-transparent border-none text-sm font-black text-[var(--input-text)] w-10 focus:outline-none p-0"
                                    oninput="window.updateOWC()">
                                <span class="text-[9px] font-bold text-zinc-500">¬∞</span>
                            </div>
                            <span class="text-[6px] text-zinc-600 font-bold uppercase">FACING</span>
                        </div>

                        <!-- 8. COS / SLOPE -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between">
                            <label for="owc-angle"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">08:
                                COS/U-D</label>
                            <div class="flex items-center gap-1">
                                <input type="number" id="owc-angle" value="0"
                                    class="bg-transparent border-none text-sm font-black text-[var(--input-text)] w-10 focus:outline-none p-0"
                                    oninput="window.updateOWC()">
                                <span class="text-[9px] font-bold text-zinc-500">¬∞</span>
                            </div>
                            <span class="text-[6px] text-zinc-600 font-bold uppercase">SLOPE</span>
                        </div>

                        <!-- 09. SMART ATMOS HUB (DA vs. ALT) -->
                        <div id="owc-atmos-card"
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between transition-all duration-300">
                            <div class="flex justify-between items-center mb-1">
                                <span id="owc-atmos-label"
                                    class="text-[7px] font-black text-blue-500 uppercase tracking-tighter">09: DENS.
                                    ALT</span>
                                <button onclick="window.fetchLiveWeather()"
                                    class="text-[6px] font-black bg-orange-600 px-1.5 py-0.5 rounded border border-orange-400 text-white hover:bg-orange-500 transition-all flex items-center gap-1">
                                    <i data-lucide="map-pin" class="w-2 h-2"></i> LIVE
                                </button>
                                <button onclick="window.toggleOWCAtmosMode()"
                                    class="text-[6px] font-black bg-blue-900/40 px-1.5 py-0.5 rounded border border-blue-500/30 text-blue-300 hover:bg-blue-600 hover:text-white transition-all">
                                    SWITCH MODE
                                </button>
                            </div>

                            <!-- Mode 1: Density Altitude (Modern) -->
                            <div id="owc-mode-da"
                                class="flex justify-start items-center bg-neutral-800/20 rounded p-1 mb-1 gap-1">
                                <input type="number" id="owc-da" value="0"
                                    class="bg-transparent text-sm font-black text-blue-400 w-11 outline-none border-none focus:ring-0"
                                    placeholder="DA"
                                    oninput="if(window.owcLiveSync) window.toggleOWCLiveSync(); window.updateOWC()">
                                <button onclick="window.syncOWCWeather(true)"
                                    class="px-1 py-1 bg-blue-600/20 border border-blue-500/30 rounded text-[7px] font-black text-blue-400 uppercase hover:bg-blue-600 hover:text-white transition-all shrink-0">SYNC</button>
                            </div>

                            <!-- Mode 2: Altitude & Temp (Classic) - HIDDEN BY DEFAULT -->
                            <div id="owc-mode-alt" class="hidden flex flex-col gap-1">
                                <div class="grid grid-cols-2 gap-1">
                                    <div
                                        class="flex items-center justify-between bg-neutral-800/20 rounded px-1 py-0.5">
                                        <label for="owc-alt" class="sr-only">Altitude</label>
                                        <input type="number" id="owc-alt" value="0" placeholder="ALT"
                                            class="bg-transparent text-[10px] font-black text-blue-400 w-full outline-none border-none focus:ring-0"
                                            oninput="if(window.owcLiveSync) window.toggleOWCLiveSync(); window.updateOWC()">
                                        <span class="text-[6px] font-bold text-zinc-500 mr-1">FT</span>
                                    </div>
                                    <div
                                        class="flex items-center justify-between bg-neutral-800/20 rounded px-1 py-0.5">
                                        <label for="owc-temp" class="sr-only">Temperature</label>
                                        <input type="number" id="owc-temp" value="59" placeholder="TEMP"
                                            class="bg-transparent text-[10px] font-black text-blue-400 w-full outline-none border-none focus:ring-0"
                                            oninput="if(window.owcLiveSync) window.toggleOWCLiveSync(); window.updateOWC()">
                                        <span class="text-[6px] font-bold text-zinc-500 mr-1">¬∞F</span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-1">
                                    <div
                                        class="flex items-center justify-between bg-neutral-800/20 rounded px-1 py-0.5">
                                        <label for="owc-hum" class="sr-only">Humidity</label>
                                        <input type="number" id="owc-hum" value="50" placeholder="HUM"
                                            class="bg-transparent text-[10px] font-black text-blue-400 w-full outline-none border-none focus:ring-0"
                                            oninput="if(window.owcLiveSync) window.toggleOWCLiveSync(); window.updateOWC()">
                                        <span class="text-[6px] font-bold text-zinc-500 mr-1">%</span>
                                    </div>
                                    <div
                                        class="flex items-center justify-between bg-neutral-800/20 rounded px-1 py-0.5">
                                        <label for="owc-press" class="sr-only">Pressure</label>
                                        <input type="number" id="owc-press" value="29.92" step="0.01" placeholder="PRES"
                                            class="bg-transparent text-[10px] font-black text-blue-400 w-full outline-none border-none focus:ring-0"
                                            oninput="if(window.owcLiveSync) window.toggleOWCLiveSync(); window.updateOWC()">
                                        <span class="text-[6px] font-bold text-zinc-500 mr-1">IN</span>
                                    </div>
                                </div>
                                <div
                                    class="flex justify-between items-center px-1 text-[7px] font-black text-blue-500/60 uppercase">
                                    <span>Calc DA:</span>
                                    <span id="owc-calc-da-display" class="text-blue-400">---</span>
                                </div>
                            </div>

                            <label for="owc-da" id="owc-atmos-footer"
                                class="text-[6px] text-zinc-600 font-bold uppercase">DENS.
                                ALTITUDE</label>
                        </div>

                        <!-- 10. ELEVATION ANSWER (GOAL) -->
                        <div
                            class="bg-blue-600 border-2 border-blue-400 p-3 rounded-xl flex flex-col shadow-[0_0_15px_rgba(37,99,235,0.4)] col-span-2 md:col-span-1">
                            <span
                                class="text-[8px] font-black text-[var(--input-text)]/80 uppercase tracking-widest mb-1">10:
                                ELEVATION ANSWER</span>
                            <div class="flex items-baseline justify-between overflow-hidden">
                                <div class="flex items-baseline gap-1">
                                    <span id="owc-elev-dir" class="text-xl font-black text-blue-200 opacity-80">U</span>
                                    <span id="owc-elev-mils"
                                        class="text-3xl font-black text-[var(--input-text)] leading-none">0.0</span>
                                    <span
                                        class="text-[10px] font-black text-blue-200 uppercase owc-unit-label">MIL</span>
                                </div>
                                <div class="text-right">
                                    <span id="owc-elev-inches"
                                        class="text-lg font-black text-blue-100 block truncate">0"</span>
                                    <span class="text-[6px] font-bold text-blue-100 uppercase">DROP</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <span id="owc-elev-clicks" class="text-[10px] font-black text-[var(--input-text)]/90">0
                                    CLICKS</span>
                                <span class="text-[8px] font-black text-blue-200 uppercase">FINAL DOPE</span>
                            </div>
                        </div>

                        <!-- 11. WIND VECTOR -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between relative overflow-hidden">
                            <span class="text-[7px] font-black text-blue-500 uppercase tracking-tighter mb-1">11:
                                WIND</span>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <label for="owc-wind-dir" class="sr-only">Wind Direction</label>
                                    <input type="number" id="owc-wind-dir" value="270" min="0" max="359"
                                        class="bg-transparent border-none text-sm font-black text-[var(--input-text)] w-10 focus:outline-none p-0"
                                        oninput="window.updateOWC()">
                                    <span class="text-[7px] font-bold text-zinc-500">¬∞</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <label for="owc-wind-speed" id="owc-wind-speed-val"
                                        class="text-sm font-black text-[var(--input-text)]">20</label>
                                    <span class="text-[7px] font-bold text-zinc-500">MPH</span>
                                </div>
                            </div>
                            <input type="range" id="owc-wind-speed" min="0" max="40" value="20"
                                class="w-full h-1 bg-[var(--input-bg)] rounded-lg appearance-none cursor-pointer accent-blue-500"
                                oninput="document.getElementById('owc-wind-speed-val').textContent=this.value; window.updateOWC()">
                            <div id="owc-wind-compass" class="absolute -right-1 -bottom-1 opacity-5">
                                <i data-lucide="compass" class="w-8 h-8"></i>
                            </div>
                        </div>

                        <!-- 12. SPIN DRIFT -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between">
                            <span class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">12:
                                SPIN</span>
                            <div class="flex items-baseline gap-1">
                                <span id="owc-spin-val" class="text-sm font-black text-[var(--input-text)]">0.0</span>
                                <span class="text-[6px] font-bold text-zinc-600 owc-unit-label">MIL</span>
                            </div>
                            <span class="text-[6px] text-zinc-600 font-bold uppercase">GYRO DRIFT</span>
                        </div>

                        <!-- 13. M/V NUDGE -->
                        <div
                            class="bg-[var(--input-bg)] border border-[var(--input-border)] p-2 rounded-lg flex flex-col justify-between">
                            <label for="owc-mv"
                                class="text-[7px] font-black text-zinc-500 uppercase tracking-tighter mb-1">13:
                                M/V</label>
                            <input type="number" id="owc-mv" value="2700"
                                class="bg-transparent border-none text-sm font-black text-[var(--input-text)] w-full focus:outline-none p-0"
                                oninput="window.updateOWC()">
                            <span class="text-[6px] text-zinc-600 font-bold uppercase">CORR. FPS</span>
                        </div>

                        <!-- 14. WINDAGE ANSWER (TALL BOX UNDER #11) -->
                        <div
                            class="bg-blue-600 border-2 border-blue-400 p-3 rounded-xl flex flex-col items-center justify-between shadow-[0_0_15px_rgba(37,99,235,0.4)] col-span-1 row-span-2 min-h-[180px] text-center overflow-visible">
                            <span
                                class="text-[7px] font-black text-[var(--input-text)]/80 uppercase tracking-widest">14:
                                WINDAGE</span>

                            <div class="flex flex-col items-center gap-1 my-1">
                                <div class="flex items-center gap-1">
                                    <span id="owc-wind-dir-callout"
                                        class="text-2xl font-black text-blue-200 opacity-80 leading-none">R</span>
                                    <span id="owc-wind-mils"
                                        class="text-3xl font-black text-[var(--input-text)] leading-none">0.0</span>
                                </div>
                                <span
                                    class="text-[8px] font-black text-blue-200 uppercase tracking-tighter owc-unit-label">MILS</span>
                            </div>

                            <div class="flex flex-col items-center border-y border-blue-400/40 py-2 w-full">
                                <span id="owc-wind-inches" class="text-xl font-black text-blue-100 block">0"</span>
                                <span class="text-[7px] font-bold text-blue-200 uppercase tracking-tighter">DRIFT</span>
                            </div>

                            <div class="flex flex-col items-center w-full gap-0.5">
                                <span id="owc-wind-clicks"
                                    class="text-[12px] font-black text-[var(--input-text)]/90 leading-tight">0
                                    CLICKS</span>
                                <span id="owc-wind-hold-label"
                                    class="text-[8px] font-black text-blue-300 uppercase leading-none">HOLD ZERO</span>
                            </div>
                        </div>

                        <!-- 15. RETICLE SYNC (WIDE BOX) -->
                        <div
                            class="bg-[var(--input-bg)]/40 border border-[var(--input-border)] p-2 rounded-lg flex flex-col items-center justify-center relative overflow-hidden min-h-[100px] shadow-inner col-span-2">
                            <span
                                class="text-[7px] font-black text-blue-500 uppercase tracking-tighter absolute top-2">15:
                                RETICLE SYNC</span>
                            <div class="w-16 h-16 border-2 border-gray-800 rounded-full relative bg-black mt-2">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-full h-[0.5px] bg-[var(--input-bg)]/50"></div>
                                    <div class="h-full w-[0.5px] bg-[var(--input-bg)]/50"></div>
                                </div>
                                <div id="owc-reticle-dot"
                                    class="w-2.5 h-2.5 bg-blue-500 rounded-full absolute shadow-[0_0_12px_rgba(37,99,235,1)] transition-all duration-300 left-1/2 top-1/2 -ml-[5px] -mt-[5px]"
                                    style="transform: translate(0,0);">
                                </div>
                            </div>
                            <span class="text-[6px] text-zinc-600 font-bold uppercase mt-1">SYNC MISSION VIEW</span>
                        </div>

                        <!-- 16. SOLVE ACTION -->
                        <div class="col-span-2 md:col-span-1">
                            <button onclick="window.solveOWC()"
                                class="w-full h-full bg-emerald-600 text-black font-black py-5 rounded-xl shadow-[0_4px_25px_rgba(34,197,94,0.4)] hover:scale-[1.02] active:scale-95 transition-all text-sm uppercase tracking-[0.2em] flex flex-col items-center justify-center gap-1 border-2 border-white/20">
                                <i data-lucide="zap" class="w-6 h-6"></i>
                                SOLVE
                            </button>
                        </div>
                    </div>

                    <!-- Mission Control Footer -->
                    <div class="mt-4 flex justify-between items-center px-2">
                        <button onclick="window.resetWorkCenter()"
                            class="bg-blue-600 hover:bg-blue-500 text-[var(--input-text)] font-black px-4 py-2 rounded text-[8px] uppercase tracking-widest transition-all">
                            RESET WORK CENTER
                        </button>
                    </div>
                </div>

                <!-- üå¶Ô∏è LIVE WEATHER STATION TAB -->
                <div id="intel-weather-station"
                    class="hidden h-full flex flex-col p-6 space-y-6 overflow-y-auto custom-scrollbar">
                    <div
                        class="flex justify-between items-center bg-neutral-600/50 p-4 rounded-xl border border-neutral-500">
                        <div>
                            <h3 class="text-xs font-black text-orange-500 uppercase tracking-[0.3em]">Live Weather
                                Station</h3>
                            <p class="text-[8px] text-zinc-500 font-bold uppercase mt-1">Real-time Environmental
                                Intelligence</p>
                        </div>
                        <button onclick="window.fetchLiveWeather()"
                            class="bg-orange-600 flex items-center gap-2 px-4 py-2 rounded-lg text-[10px] font-black text-white hover:bg-orange-500 shadow-lg shadow-orange-600/20 active:scale-95 transition-all">
                            <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i> FETCH LIVE DATA
                        </button>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <!-- Temp Widget -->
                        <div
                            class="bg-neutral-800/20 border border-white/5 p-4 rounded-xl flex flex-col items-center justify-center text-center">
                            <i data-lucide="thermometer" class="w-6 h-6 text-red-500 mb-2"></i>
                            <span class="text-[8px] text-zinc-600 font-black uppercase mb-1">Temperature</span>
                            <span id="ws-temp" class="text-3xl font-black text-white italic">--¬∞F</span>
                        </div>
                        <!-- Humidity Widget -->
                        <div
                            class="bg-neutral-800/20 border border-white/5 p-4 rounded-xl flex flex-col items-center justify-center text-center">
                            <i data-lucide="droplets" class="w-6 h-6 text-blue-500 mb-2"></i>
                            <span class="text-[8px] text-zinc-600 font-black uppercase mb-1">Humidity</span>
                            <span id="ws-hum" class="text-3xl font-black text-white italic">--%</span>
                        </div>
                        <!-- Pressure Widget -->
                        <div
                            class="bg-neutral-800/20 border border-white/5 p-4 rounded-xl flex flex-col items-center justify-center text-center">
                            <i data-lucide="gauge" class="w-6 h-6 text-emerald-500 mb-2"></i>
                            <span class="text-[8px] text-zinc-600 font-black uppercase mb-1">Station Pressure</span>
                            <span id="ws-press" class="text-3xl font-black text-white italic">-- IN</span>
                        </div>
                        <!-- Wind Widget -->
                        <div
                            class="bg-neutral-800/20 border border-white/5 p-4 rounded-xl flex flex-col items-center justify-center text-center">
                            <i data-lucide="wind" class="w-6 h-6 text-blue-400 mb-2"></i>
                            <span class="text-[8px] text-zinc-600 font-black uppercase mb-1">Wind Conditions</span>
                            <span id="ws-wind" class="text-xl font-black text-white italic">-- MPH @ --¬∞</span>
                        </div>
                    </div>

                    <!-- Altitude & DA Row -->
                    <div class="grid grid-cols-3 gap-2">
                        <div
                            class="bg-blue-900/10 border border-blue-500/20 p-3 rounded-lg flex flex-col items-center justify-center text-center group transition-all hover:bg-blue-900/20">
                            <span class="text-[7px] text-zinc-500 font-black uppercase mb-0.5">Topo Elev (MSL)</span>
                            <span id="ws-msl" class="text-lg font-black text-blue-200">-- FT</span>
                        </div>
                        <div
                            class="bg-emerald-900/10 border border-emerald-500/20 p-3 rounded-lg flex flex-col items-center justify-center text-center group transition-all hover:bg-emerald-900/20">
                            <span class="text-[7px] text-zinc-500 font-black uppercase mb-0.5">Sensor Alt (ASL)</span>
                            <span id="ws-asl" class="text-lg font-black text-emerald-200">-- FT</span>
                        </div>
                        <div
                            class="bg-orange-900/10 border border-orange-500/30 p-3 rounded-lg flex flex-col items-center justify-center text-center group transition-all hover:bg-orange-900/20">
                            <span class="text-[7px] text-orange-500/60 font-black uppercase mb-0.5">Density Alt</span>
                            <span id="ws-da" class="text-lg font-black text-orange-400">-- FT</span>
                        </div>
                    </div>

                    <div class="bg-neutral-600/30 border border-neutral-500 p-4 rounded-xl space-y-3">
                        <div class="flex justify-between items-center text-[10px] font-bold">
                            <span class="text-zinc-500 uppercase">GPS Location</span>
                            <span id="ws-coords" class="text-blue-400 font-mono animate-pulse">ACQUIRING GPS
                                SIGNAL...</span>
                        </div>
                        <div class="flex justify-between items-center text-[10px] font-bold">
                            <span class="text-zinc-500 uppercase">Last Updated</span>
                            <span id="ws-timestamp" class="text-zinc-400 font-mono">--:--:--</span>
                        </div>
                        <div class="pt-2 border-t border-neutral-500">
                            <p class="text-[8px] text-zinc-600 leading-relaxed italic">
                                * Data sourced from Open-Meteo API using high-precision GPS triangulation.
                                Station Pressure is derived directly for use in high-fidelity ballistics.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- AI Advisor Tab -->
                <div id="intel-ai-advisor" class="h-full flex flex-col space-y-4">
                    <div class="flex items-center justify-between px-4 pt-2">
                        <span class="text-[10px] font-black text-blue-500 uppercase tracking-[0.2em]">Live Tactical
                            Support</span>
                        <button onclick="window.clearAIChat()"
                            class="flex items-center gap-1.5 px-3 py-1 bg-red-600/10 border border-red-500/20 rounded-lg text-red-500 text-[9px] font-black uppercase hover:bg-red-600 hover:text-white transition-all group">
                            <i data-lucide="trash-2" class="w-3 h-3 transition-transform group-hover:scale-110"></i>
                            CLEAR SCREEN
                        </button>
                    </div>
                    <div class="flex flex-col h-full overflow-hidden">
                        <div id="ai-chat-history"
                            class="flex-1 overflow-y-auto custom-scrollbar space-y-4 p-4 font-mono text-[11px]">
                            <!-- Chat lines -->
                            <div class="flex gap-2">
                                <span class="text-blue-700">SYS:</span>
                                <span>SYSTEM READY. STANDING BY FOR MISSION PARAMETERS...</span>
                            </div>
                        </div>
                        <!-- Quick Action Chips -->
                        <div class="flex gap-2 px-4 mb-2 overflow-x-auto no-scrollbar py-2">
                            <button onclick="sendAICommand('ANALYZE')"
                                class="shrink-0 bg-blue-600/20 border border-blue-500/30 text-blue-400 text-[9px] font-black px-3 py-1.5 rounded-full uppercase tracking-widest hover:bg-blue-600 hover:text-white transition-all">
                                üìä ANALYZE
                            </button>
                            <button onclick="sendAICommand('WEATHER')"
                                class="shrink-0 bg-orange-600/20 border border-orange-500/30 text-orange-400 text-[9px] font-black px-3 py-1.5 rounded-full uppercase tracking-widest hover:bg-orange-600 hover:text-white transition-all">
                                ‚òÅÔ∏è WEATHER
                            </button>
                            <button onclick="sendAICommand('SYNC')"
                                class="shrink-0 bg-emerald-600/20 border border-emerald-500/30 text-emerald-400 text-[9px] font-black px-3 py-1.5 rounded-full uppercase tracking-widest hover:bg-emerald-600 hover:text-white transition-all">
                                üîÑ SYNC
                            </button>
                            <button onclick="sendAICommand('STATUS')"
                                class="shrink-0 bg-zinc-800 border border-zinc-700 text-zinc-400 text-[9px] font-black px-3 py-1.5 rounded-full uppercase tracking-widest hover:bg-zinc-600 hover:text-white transition-all">
                                üõ°Ô∏è STATUS
                            </button>
                        </div>

                        <div
                            class="flex items-center gap-2 bg-[var(--input-bg)]/40 border border-[var(--input-border)] rounded-lg px-3 py-1.5 focus-within:border-blue-500/50 transition-colors mx-4">
                            <label for="ai-chat-input" class="sr-only">AI Advisor Command</label>
                            <span class="text-blue-900 font-black text-xs mr-1">></span>
                            <input type="text" id="ai-chat-input"
                                class="flex-1 bg-transparent border-none text-[10px] text-[var(--input-text)] placeholder-zinc-700 focus:outline-none"
                                placeholder="Enter Command (Help / Status / Analyze)...">
                            <button onclick="processChatCommand()"
                                class="bg-blue-600 hover:bg-blue-500 text-[var(--input-text)] rounded p-1.5 transition-all">
                                <i data-lucide="corner-down-left" class="w-3.5 h-3.5"></i>
                            </button>
                        </div>
                    </div>
                </div>


                <!-- TACTICAL MAP HUB (RANGE-TO-PIN) -->
                <div id="intel-tactical-map" class="hidden space-y-4">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between px-4 pt-2 gap-3">
                        <div class="flex items-center gap-2">
                            <i data-lucide="globe" class="w-4 h-4 text-blue-500"></i>
                            <span class="text-[10px] font-black text-blue-100 uppercase tracking-[0.2em]">Google
                                Satellite Range Analysis</span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="window.toggleMapUnits()"
                                class="bg-neutral-600 hover:bg-neutral-500 text-white text-[9px] font-black px-3 py-1 rounded uppercase transition-all flex items-center gap-1.5 border border-neutral-500">
                                <i data-lucide="ruler" class="w-3 h-3"></i> YDS/M
                            </button>
                            <button onclick="window.toggleMapPathMode()" id="btn-map-link"
                                class="bg-neutral-600 hover:bg-neutral-500 text-white text-[9px] font-black px-3 py-1 rounded uppercase transition-all flex items-center gap-1.5 border border-neutral-500">
                                <i data-lucide="circle-dot" class="w-3 h-3"></i> RADIAL
                            </button>
                            <button onclick="window.clearMapTargets()"
                                class="bg-red-900/20 hover:bg-red-900/40 text-red-500 text-[9px] font-black px-3 py-1 rounded uppercase transition-all flex items-center gap-1.5">
                                <i data-lucide="trash-2" class="w-3 h-3"></i> Clear
                            </button>
                            <button onclick="window.tacticalMapHardReset();"
                                class="bg-blue-600 hover:bg-blue-500 text-white text-[9px] font-black px-3 py-1 rounded uppercase transition-all flex items-center gap-1.5">
                                <i data-lucide="refresh-cw" class="w-3 h-3"></i> Reset Map
                            </button>
                        </div>
                    </div>
                    <div class="px-4">
                        <!-- Visual shell: carries overflow-hidden & rounded corners.
                             The actual Leaflet container sits inside with absolute positioning
                             so Leaflet always reads correct pixel dimensions. -->
                        <div
                            class="w-full h-[450px] rounded-2xl border-2 border-neutral-500/50 overflow-hidden shadow-2xl relative bg-neutral-900">
                            <div id="tactical-map-container" style="position:absolute;inset:0;width:100%;height:100%;">
                                <!-- Map initialized here -->
                            </div>
                        </div>
                        <div
                            class="mt-4 bg-neutral-800/50 border border-neutral-500 p-4 rounded-xl flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <i data-lucide="ruler" class="w-8 h-8 text-blue-500/50"></i>
                                <div>
                                    <p class="text-[8px] text-zinc-500 font-black uppercase mb-1">Calculated Baseline
                                    </p>
                                    <h3 id="map-dist-val" class="text-2xl font-black text-white leading-none">0 <span
                                            class="text-xs text-blue-500">YDS</span></h3>
                                </div>
                            </div>
                            <div class="flex flex-col items-end gap-2">
                                <button onclick="window.syncMapRange()"
                                    class="bg-blue-600 hover:bg-blue-500 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase transition-all flex items-center gap-1.5">
                                    <i data-lucide="arrow-up-right" class="w-3 h-3"></i> Sync Range ‚Üí OWC
                                </button>
                                <span class="text-[9px] font-mono text-emerald-400 flex items-center gap-1">
                                    <i data-lucide="check-circle-2" class="w-3 h-3"></i> GPS READY
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- GPS RANGEFINDER (MARK & WALK) -->
                <div id="intel-gps-rangefinder" class="hidden space-y-4">
                    <div class="flex items-center justify-between px-4 pt-2">
                        <div class="flex items-center gap-2">
                            <i data-lucide="satellite-dish" class="w-5 h-5 text-orange-500"></i>
                            <span class="text-[10px] font-black text-orange-500 uppercase tracking-[0.2em]">Mark & Walk
                                Tracker</span>
                        </div>
                    </div>

                    <div class="px-4 space-y-4">
                        <div
                            class="bg-black/40 border-2 border-orange-500/20 rounded-3xl p-8 flex flex-col items-center justify-center text-center shadow-2xl relative overflow-hidden">
                            <div class="absolute inset-0 bg-gradient-radial from-orange-500/5 to-transparent"></div>

                            <p class="text-xs font-black text-zinc-500 uppercase tracking-widest mb-2">Manual
                                Displacement
                            </p>
                            <h2 id="gps-dist-val" class="text-6xl font-black text-white italic tracking-tighter mb-2">
                                0.0
                            </h2>
                            <p class="text-blue-500 font-black tracking-[0.3em] uppercase">Yards to Target</p>

                            <div class="mt-8 grid grid-cols-2 gap-4 w-full relative z-10">
                                <button onclick="window.markGPSTarget()"
                                    class="bg-orange-600 hover:bg-orange-500 text-white font-black py-4 rounded-2xl shadow-lg shadow-orange-900/40 transition-all active:scale-95 uppercase text-[10px] tracking-widest flex items-center justify-center gap-2">
                                    <i data-lucide="target" class="w-4 h-4"></i> Mark Target
                                </button>
                                <button onclick="window.resetGPSRange()"
                                    class="bg-zinc-800 hover:bg-zinc-700 text-zinc-400 font-black py-4 rounded-2xl transition-all active:scale-95 uppercase text-[10px] tracking-widest flex items-center justify-center gap-2">
                                    <i data-lucide="refresh-ccw" class="w-4 h-4"></i> Reset
                                </button>
                            </div>
                        </div>

                        <div class="bg-zinc-900/80 border border-white/10 rounded-2xl p-4 space-y-3">
                            <div class="flex justify-between items-center text-[10px]">
                                <span class="text-zinc-500 font-black uppercase flex items-center gap-1.5">
                                    <i data-lucide="map-pin" class="w-3 h-3 text-blue-500"></i> Current Location
                                </span>
                                <span id="gps-live-coords" onclick="window.initGPSRangefinder()"
                                    class="text-blue-400 font-mono italic cursor-pointer">Searching...</span>
                            </div>
                            <div class="flex justify-between items-center text-[10px]">
                                <span class="text-zinc-500 font-black uppercase flex items-center gap-1.5">
                                    <i data-lucide="crosshair" class="w-3 h-3 text-orange-500"></i> Target Lock
                                </span>
                                <span id="gps-target-coords" class="text-orange-400 font-mono">NO LOCK</span>
                            </div>
                            <button onclick="window.syncGPSRange()"
                                class="w-full py-3 bg-blue-600/20 border border-blue-500/30 text-blue-400 font-black text-[10px] rounded-xl uppercase hover:bg-blue-600 hover:text-white transition-all flex items-center justify-center gap-2">
                                <i data-lucide="arrow-up-right" class="w-3.5 h-3.5"></i> Sync to Work Center
                            </button>
                        </div>
                    </div>
                </div>

                <!-- LEGAL TAB -->
                <div id="intel-legal"
                    class="hidden h-full flex flex-col p-6 pb-24 overflow-y-auto custom-scrollbar space-y-8">

                    <!-- HEADER -->
                    <div class="border-b border-gray-800 pb-4">
                        <h2 class="text-xl font-black text-white uppercase tracking-widest">Legal & Licensing</h2>
                        <p class="text-xs text-gray-500 mt-1">Terms of use, intellectual property, and guidelines.</p>
                    </div>



                    <!-- LICENSE SECTION -->
                    <div class="space-y-4">
                        <h3
                            class="text-sm font-black text-neon-green uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="shield-check" class="w-4 h-4"></i> Proprietary License
                        </h3>
                        <div
                            class="bg-black p-4 rounded-lg border border-neon-green/30 text-xs font-mono text-neon-green/80 leading-relaxed shadow-[0_0_20px_rgba(34,197,94,0.1)]">
                            <p class="mb-4 font-bold text-base">PROPRIETARY LICENSE - ALL RIGHTS RESERVED</p>
                            <p><strong>Application:</strong> Tactical Range Card (FREE & PRO Versions)</p>
                            <p><strong>Owner:</strong> Ralph Mccabe</p>
                            <hr class="border-neon-green/20 my-4">
                            <p>¬© 2026 Ralph Mccabe. All Rights Reserved.</p>
                        </div>
                    </div>

                </div>

                <!-- üß≠ TACTICAL COMPASS HUB (OPERATOR HUD) -->
                <div id="intel-tactical-compass" class="hidden space-y-6">
                    <div
                        class="glow-container glow-amber p-6 rounded-2xl border-2 border-current/20 bg-black/40 shadow-2xl relative overflow-hidden h-[65vh] flex flex-col items-center justify-center">

                        <!-- NEW: Sensor Unlock Overlay -->
                        <div id="hud-sensor-prompt"
                            class="absolute inset-0 z-[100] bg-black/90 flex flex-col items-center justify-center p-8 text-center space-y-4">
                            <i data-lucide="shield-alert" class="w-12 h-12 text-current animate-pulse"></i>
                            <h3 class="text-xl font-black uppercase tracking-widest">Sensor Authorization Required</h3>
                            <p class="text-xs text-gray-400 max-w-xs font-mono">Mobile devices require a manual user
                                gesture to enable the Compass and Inclinometer. Tap below to unlock navigation sensors.
                            </p>
                            <button onclick="requestSensorAccess()"
                                class="bg-blue-600 hover:bg-blue-500 text-white font-black px-8 py-3 rounded-lg text-sm uppercase tracking-widest shadow-2xl active:scale-95 transition-all">
                                AUTHORIZE HUD SENSORS
                            </button>
                            <p id="hud-diagnostic-msg" class="text-[8px] opacity-30 mt-4 font-mono"></p>
                        </div>

                        <!-- HUD Overlay Details -->
                        <div class="absolute top-4 left-6 text-left space-y-1 z-20">
                            <p class="text-[10px] font-mono font-black opacity-50 uppercase tracking-tighter">Operator
                                Orientation</p>
                            <h2 class="text-3xl font-black font-mono leading-none tracking-tighter"
                                id="hud-heading-val">
                                000¬∞</h2>
                            <p class="text-[10px] font-black opacity-80" id="hud-cardinal-val">NORTH</p>
                        </div>
                        <div class="absolute top-4 right-6 text-right space-y-1 z-20">
                            <p class="text-[10px] font-mono font-black opacity-50 uppercase tracking-tighter">
                                Inclinometer</p>
                            <h2 class="text-3xl font-black font-mono leading-none tracking-tighter" id="hud-angle-val">
                                0.0¬∞</h2>
                            <p class="text-[10px] font-black opacity-80" id="hud-cos-val">COS 1.00</p>
                        </div>

                        <!-- Central Compass HUD -->
                        <div class="relative w-64 h-64 md:w-80 md:h-80 flex items-center justify-center">
                            <!-- Outer Static Ring -->
                            <div
                                class="absolute inset-0 rounded-full border-4 border-current/10 shadow-[0_0_50px_rgba(var(--glow-rgb),0.1)]">
                            </div>

                            <!-- Rotating Compass Card -->
                            <div id="hud-compass-card"
                                class="w-full h-full relative transition-transform duration-100 ease-out"
                                style="transform: rotate(0deg);">
                                <!-- Degrees 0-360 -->
                                <div class="absolute inset-0 rounded-full border-2 border-current/40"></div>
                                <!-- CSS-based markings will be injected or styled -->
                                <div class="absolute inset-0 flex justify-center py-2"><span
                                        class="font-black text-sm">N</span></div>
                                <div class="absolute inset-0 flex justify-center py-2 rotate-90"><span
                                        class="font-black text-sm">E</span></div>
                                <div class="absolute inset-0 flex justify-center py-2 rotate-180"><span
                                        class="font-black text-sm">S</span></div>
                                <div class="absolute inset-0 flex justify-center py-2 -rotate-90"><span
                                        class="font-black text-sm">W</span></div>
                            </div>

                            <!-- Fixed Center HUD Reticle -->
                            <div class="absolute z-20 w-16 h-16 pointer-events-none flex items-center justify-center">
                                <div class="w-full h-[1px] bg-current opacity-40"></div>
                                <div class="h-full w-[1px] bg-current opacity-40 absolute"></div>
                                <div
                                    class="w-8 h-8 rounded-full border border-current shadow-[0_0_15px_rgba(var(--glow-rgb),1)] animate-pulse">
                                </div>
                            </div>

                            <!-- Inclinometer Arc (Vertical Scale) -->
                            <div class="absolute -right-12 h-64 border-l-2 border-current/30 flex items-center">
                                <div id="hud-inclinometer-marker"
                                    class="absolute left-[-6px] transition-all duration-300">
                                    <div class="w-3 h-[2px] bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.8)]"></div>
                                </div>
                                <div
                                    class="flex flex-col justify-between h-full py-1 ml-2 text-[8px] font-mono font-black opacity-40">
                                    <span>+90</span><span>+45</span><span>0</span><span>-45</span><span>-90</span>
                                </div>
                            </div>

                            <!-- Bubble Level (CANT) -->
                            <div
                                class="absolute -bottom-12 w-64 h-4 bg-zinc-900/80 rounded-full border border-current/20 overflow-hidden flex items-center justify-center px-1">
                                <div
                                    class="absolute left-1/2 -translate-x-1/2 w-[1px] h-full bg-current/40 bg-zinc-400 z-10">
                                </div>
                                <div id="hud-bubble-marker"
                                    class="w-4 h-4 bg-current rounded-full shadow-[0_0_10px_rgba(var(--glow-rgb),1)] transition-transform duration-100 ease-out"
                                    style="transform: translateX(0px);"></div>
                            </div>
                        </div>

                        <!-- HUD Footer Controls -->
                        <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex flex-col items-center gap-4 z-20">
                            <div class="flex gap-4">
                                <button onclick="window.calibrateCompassOffset()"
                                    class="bg-orange-600 hover:bg-orange-500 text-white font-black px-6 py-3 rounded-lg text-xs uppercase tracking-widest transition-all shadow-xl active:scale-95 border-2 border-white/10 flex items-center gap-2">
                                    <i data-lucide="compass" class="w-4 h-4"></i> SET NORTH
                                </button>
                                <button onclick="window.resetCompassOffset()"
                                    class="bg-zinc-800 hover:bg-zinc-700 text-zinc-400 font-black px-4 py-3 rounded-lg text-xs uppercase tracking-widest transition-all active:scale-95 border border-white/5">
                                    RESET
                                </button>
                            </div>
                            <div class="flex gap-4">
                                <div class="flex bg-black/60 rounded-lg p-1 border border-current/20 scale-90">
                                    <button onclick="setCompassGlow('amber')"
                                        class="p-2 rounded hover:bg-white/10 transition-colors">
                                        <div class="w-4 h-4 bg-orange-500 rounded-full"></div>
                                    </button>
                                    <button onclick="setCompassGlow('red')"
                                        class="p-2 rounded hover:bg-white/10 transition-colors">
                                        <div class="w-4 h-4 bg-red-600 rounded-full"></div>
                                    </button>
                                    <button onclick="setCompassGlow('green')"
                                        class="p-2 rounded hover:bg-white/10 transition-colors">
                                        <div class="w-4 h-4 bg-emerald-500 rounded-full"></div>
                                    </button>
                                </div>
                                <button onclick="syncCompassToOWC()"
                                    class="bg-blue-600 hover:bg-blue-500 text-white font-black px-6 py-3 rounded-lg text-xs uppercase tracking-widest transition-all shadow-xl active:scale-95 border-2 border-white/10">
                                    SYNC TO OWC
                                </button>
                            </div>
                        </div>

                        <!-- Scan Line Effect -->
                        <div class="absolute inset-0 bg-scan-line pointer-events-none opacity-5"></div>
                    </div>
                </div>

                <!-- CONNECTIVITY TAB -->
                <div id="intel-connectivity"
                    class="hidden h-[65vh] flex flex-col p-4 landscape:h-full landscape:overflow-y-auto w-full space-y-4">
                    <div class="flex justify-between items-center bg-black/40 p-3 rounded-lg border border-gray-800">
                        <h3 class="text-xs font-black text-blue-500 uppercase tracking-widest">Bluetooth Streamer</h3>
                        <button onclick="toggleBluetoothConnection()" id="bt-connect-btn"
                            class="bg-blue-600 hover:bg-blue-500 text-white text-[10px] font-black px-4 py-2 rounded uppercase tracking-widest transition-all">
                            SCAN & CONNECT
                        </button>
                        <button onclick="BluetoothManager.toggleSimulation()" id="btn-simulate"
                            class="bg-purple-600 hover:bg-purple-500 text-white text-[10px] font-black px-4 py-2 rounded uppercase tracking-widest transition-all ml-2">
                            SIMULATE
                        </button>
                    </div>
                    <div id="bt-log-container"
                        class="flex-1 bg-black font-mono text-[9px] p-4 rounded-lg border border-gray-800 overflow-y-auto custom-scrollbar whitespace-pre-wrap shadow-inner h-full flex flex-col gap-1">
                        <span class="opacity-50 text-green-500">> SYSTEM READY...</span>
                        <span class="opacity-50 text-green-500">> WAITING FOR BLE SIGNAL...</span>
                    </div>

                    <!-- Command Input (Future Proofing) -->
                    <div class="flex gap-2">
                        <label for="bt-cmd-input" class="sr-only">Bluetooth Command Input</label>
                        <input type="text" id="bt-cmd-input" placeholder="ENTER COMMAND (HEX/ASCII)" disabled
                            class="flex-1 bg-black/40 border border-gray-800 rounded px-3 py-2 text-[10px] text-white font-mono outline-none focus:border-blue-500">
                        <button disabled
                            class="bg-zinc-800 text-zinc-500 px-4 py-2 rounded text-[10px] font-black uppercase">SEND</button>
                    </div>
                </div>

                <!-- SCOPE CAM TAB (PRECISION MONITOR v3.1) -->
                <div id="intel-scope-cam"
                    class="hidden h-full flex flex-col md:flex-row p-0 relative overflow-hidden bg-black md:rounded-xl md:border border-gray-800">

                    <!-- LEFT/SIDE COLUMN: CONTROLS -->
                    <div
                        class="w-full md:w-[250px] order-2 md:order-1 flex flex-col border-t md:border-t-0 md:border-r border-white/5 bg-zinc-950/80 backdrop-blur-md z-20 overflow-y-auto">
                        <!-- MISSION HEADER -->
                        <div class="p-4 border-b border-white/5">
                            <h3 class="text-[9px] font-black text-blue-400 uppercase tracking-[0.2em]">PRECISION FEED
                            </h3>
                            <p class="text-[8px] text-zinc-500 uppercase mt-1">Sensor: Active | Sync: OK</p>
                        </div>

                        <!-- FEED CONTROLS (PORTRAIT / STACKED) -->
                        <div id="scope-cam-controls-portrait" class="hidden flex flex-col p-4 space-y-4 md:hidden">
                            <!-- ZOOM -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-[8px] font-bold text-zinc-400 uppercase">MAGNIFICATION</span>
                                    <span id="label-zoom-val-p" class="text-[10px] font-black text-white">1.0X</span>
                                </div>
                                <label for="scope-cam-zoom-p" class="sr-only">Scope Magnification (Portrait)</label>
                                <input type="range" id="scope-cam-zoom-p" min="1" max="10" step="0.1" value="1"
                                    oninput="window.syncScopeZoom(this.value)"
                                    class="w-full accent-blue-500 h-1 bg-white/10 rounded-lg appearance-none">
                            </div>

                            <!-- BORESIGHT ALIGNMENT (NUDGE) -->
                            <div class="py-2 border-t border-white/5 space-y-2">
                                <span class="text-[8px] font-bold text-zinc-400 uppercase">Boresight Alignment</span>
                                <div class="grid grid-cols-3 gap-1 max-w-[120px] mx-auto">
                                    <div></div>
                                    <button onclick="window.nudgeReticle(0,-1)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-up" class="w-3 h-3 mx-auto"></i></button>
                                    <div></div>
                                    <button onclick="window.nudgeReticle(-1,0)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-left" class="w-3 h-3 mx-auto"></i></button>
                                    <button onclick="window.resetReticle()"
                                        class="p-2 bg-blue-600/20 rounded text-[8px] font-black">RESET</button>
                                    <button onclick="window.nudgeReticle(1,0)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-right" class="w-3 h-3 mx-auto"></i></button>
                                    <div></div>
                                    <button onclick="window.nudgeReticle(0,1)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-down" class="w-3 h-3 mx-auto"></i></button>
                                    <div></div>
                                </div>
                            </div>

                            <!-- RECORDING -->
                            <div class="flex gap-2">
                                <button id="p-record-start" onclick="startScopeRecording()"
                                    class="flex-1 bg-red-600 text-white rounded-lg py-3 flex items-center justify-center gap-2 active:scale-95">
                                    <div class="w-2 h-2 bg-white rounded-full"></div>
                                    <span class="text-[9px] font-black uppercase">START</span>
                                </button>
                                <button id="p-record-stop" onclick="stopScopeRecording()"
                                    class="hidden flex-1 bg-white text-red-600 rounded-lg py-3 flex items-center justify-center gap-2 animate-pulse">
                                    <div class="w-2 h-2 bg-red-600 rounded-sm"></div>
                                    <span class="text-[9px] font-black uppercase">STOP</span>
                                </button>
                                <button onclick="window.rotateScopeFeed()"
                                    class="p-3 bg-white/5 border border-white/10 rounded-lg text-white">
                                    <i data-lucide="rotate-cw" class="w-4 h-4"></i>
                                </button>
                            </div>

                            <button onclick="stopScopeCam()"
                                class="w-full bg-zinc-800 text-zinc-400 rounded-lg py-2 text-[8px] font-black uppercase">TERMINATE</button>
                        </div>

                        <!-- FEED CONTROLS (LANDSCAPE / MOUNTED SIDEBAR) -->
                        <div id="scope-cam-controls-landscape"
                            class="hidden flex flex-col p-3 space-y-4 h-full overflow-y-auto custom-scrollbar">
                            <span
                                class="text-[8px] font-black text-blue-400 uppercase tracking-widest text-center">Mounted</span>

                            <!-- Shrunken REC Buttons -->
                            <div class="space-y-2">
                                <button id="l-record-start" onclick="startScopeRecording()"
                                    class="w-full bg-red-600 hover:bg-red-500 text-white rounded-xl py-4 flex flex-col items-center justify-center gap-1 shadow-lg active:scale-95 transition-all">
                                    <div class="w-3 h-3 bg-white rounded-full"></div>
                                    <span class="text-[9px] font-black uppercase tracking-widest">START</span>
                                </button>
                                <button id="l-record-stop" onclick="stopScopeRecording()"
                                    class="hidden w-full bg-white text-red-600 rounded-xl py-4 flex flex-col items-center justify-center gap-1 shadow-lg animate-pulse transition-all">
                                    <div class="w-3 h-3 bg-red-600 rounded-sm"></div>
                                    <span class="text-[9px] font-black uppercase tracking-widest">STOP</span>
                                </button>
                            </div>

                            <!-- ZOOM Slider for Sidebar -->
                            <div class="space-y-2">
                                <div class="flex justify-between text-[8px] font-bold text-zinc-400">
                                    <span>MAGNIFICATION</span>
                                    <span id="label-zoom-val-l">1.0X</span>
                                </div>
                                <label for="scope-cam-zoom-l" class="sr-only">Scope Magnification (Landscape)</label>
                                <input type="range" id="scope-cam-zoom-l" min="1" max="10" step="0.1" value="1"
                                    oninput="window.syncScopeZoom(this.value)"
                                    class="w-full h-1 bg-white/10 rounded-lg appearance-none accent-blue-500">
                            </div>

                            <!-- NUDGE for Sidebar -->
                            <div class="space-y-2 pt-2 border-t border-white/5">
                                <span class="text-[8px] font-bold text-zinc-400 uppercase block text-center">Boresight
                                    Alignment</span>
                                <div class="grid grid-cols-3 gap-1 max-w-[120px] mx-auto">
                                    <div></div>
                                    <button onclick="window.nudgeReticle(0,-1)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-up" class="w-3 h-3 mx-auto"></i></button>
                                    <div></div>
                                    <button onclick="window.nudgeReticle(-1,0)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-left" class="w-3 h-3 mx-auto"></i></button>
                                    <button onclick="window.resetReticle()"
                                        class="p-2 bg-blue-600/20 rounded text-[7px] font-black">RESET</button>
                                    <button onclick="window.nudgeReticle(1,0)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-right" class="w-3 h-3 mx-auto"></i></button>
                                    <div></div>
                                    <button onclick="window.nudgeReticle(0,1)" class="p-2 bg-white/5 rounded"><i
                                            data-lucide="chevron-down" class="w-3 h-3 mx-auto"></i></button>
                                    <div></div>
                                </div>
                            </div>

                            <!-- Tools -->
                            <div class="grid grid-cols-2 gap-2 mt-auto">
                                <button onclick="window.rotateScopeFeed()"
                                    class="bg-white/5 border border-white/10 rounded-lg p-3 text-white">
                                    <i data-lucide="rotate-cw" class="w-4 h-4 mx-auto"></i>
                                </button>
                                <button onclick="stopScopeCam()"
                                    class="bg-zinc-800 text-zinc-400 border border-white/5 rounded-lg p-3">
                                    <i data-lucide="power" class="w-4 h-4 mx-auto text-red-500/50"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT/MAIN COLUMN: THE MONITOR -->
                    <div id="scope-monitor-container"
                        class="flex-1 flex items-center justify-center bg-black relative p-4 md:p-8 order-1 md:order-2 self-stretch">
                        <!-- PRECISION MONITOR FRAME -->
                        <div id="scope-monitor-frame"
                            class="relative aspect-square h-full max-w-full bg-zinc-900 rounded-lg border-2 border-blue-500/50 shadow-[0_0_50px_rgba(37,99,235,0.2)] overflow-hidden">

                            <!-- 1. LIVE CAMERA FEED -->
                            <video id="scope-cam-video" autoplay playsinline muted
                                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full object-cover z-0"></video>

                            <!-- 2. HUD OVERLAY (CLEAN) -->
                            <div id="scope-cam-overlay"
                                class="absolute inset-0 z-10 pointer-events-none border-4 border-white/5">
                                <!-- CROSSHAIR SYMBOL -->
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-8 h-[1px] bg-blue-500/30"></div>
                                    <div class="h-8 w-[1px] bg-blue-500/30 absolute"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 4. PERMISSION OVERLAY -->
                        <div id="scope-cam-start-overlay"
                            class="absolute inset-0 z-30 bg-black/95 flex flex-col items-center justify-center p-6 text-center space-y-4">
                            <div
                                class="w-16 h-16 bg-zinc-900 rounded-full flex items-center justify-center border border-white/5">
                                <i data-lucide="camera" class="w-8 h-8 text-blue-500 animate-pulse"></i>
                            </div>
                            <h3 class="text-xs font-black text-neon-green tracking-[0.3em] uppercase mb-4">TRC PRO v3.8
                            </h3>
                            <button onclick="window.initScopeCam()"
                                class="bg-blue-600 hover:bg-blue-500 text-white font-black px-8 py-4 rounded-lg text-[10px] uppercase tracking-widest shadow-[0_0_20px_rgba(37,99,235,0.4)] transition-all active:scale-95">
                                ACTIVATE SENSOR
                            </button>
                        </div>
                    </div>
                </div>

                <!-- TARGET CAM TAB (Tactical Reconnaissance Camera) -->
                <div id="intel-target-cam"
                    class="hidden h-[65vh] landscape:h-full flex flex-col p-0 relative overflow-hidden bg-black md:rounded-xl md:border border-gray-800">

                    <!-- Camera View -->
                    <div class="flex-1 flex items-center justify-center bg-black relative min-h-0">
                        <video id="target-cam-video" autoplay playsinline muted
                            class="w-full h-full object-cover"></video>

                        <!-- Metadata Overlay (Top) -->
                        <div class="absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/80 to-transparent">
                            <div class="flex justify-between items-start text-[9px] font-mono text-green-400">
                                <div class="space-y-1">
                                    <div id="target-gps-display">GPS: --</div>
                                    <div id="target-heading-display">HDG: --</div>
                                </div>
                                <div class="space-y-1 text-right">
                                    <div id="target-angle-display">ANG: --</div>
                                    <div id="target-time-display">--:--:--</div>
                                </div>
                            </div>
                        </div>

                        <!-- Crosshair Overlay -->
                        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
                            <div class="w-12 h-[2px] bg-blue-500/40"></div>
                            <div class="h-12 w-[2px] bg-blue-500/40 absolute"></div>
                        </div>
                    </div>

                    <!-- Controls Bar (Bottom) - FIXED FOR MOBILE -->
                    <div class="bg-zinc-950/95 border-t border-white/10 p-3 flex justify-between items-center shrink-0">
                        <button onclick="window.stopTargetCam()"
                            class="bg-zinc-800 text-zinc-400 px-3 py-2 rounded text-[9px] font-black uppercase">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                        <button id="target-cam-capture" onclick="window.captureTargetPhoto()"
                            class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest shadow-lg active:scale-95 transition-all">
                            <i data-lucide="camera" class="w-5 h-5 inline mr-2"></i> CAPTURE
                        </button>
                        <button onclick="window.switchIntelTab('vault')"
                            class="bg-zinc-800 text-white px-3 py-2 rounded text-[9px] font-black uppercase">
                            <i data-lucide="archive" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>

                <!-- INTEL VAULT TAB (Target Photo Storage) -->
                <div id="intel-vault"
                    class="hidden h-full flex flex-col space-y-4 overflow-y-auto p-4 md:p-6 custom-scrollbar">

                    <!-- Header -->
                    <div
                        class="flex justify-between items-center bg-blue-900/20 p-2 rounded-lg border border-blue-500/20">
                        <div class="flex items-center gap-2">
                            <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></div>
                            <span class="text-[9px] font-black text-blue-200 uppercase tracking-widest">Intel
                                Vault</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="window.switchIntelTab('target-cam')"
                                class="bg-blue-600 hover:bg-blue-500 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all">
                                <i data-lucide="camera" class="w-3 h-3 inline mr-1"></i> NEW
                            </button>
                            <button onclick="window.clearVault()"
                                class="bg-zinc-800 hover:bg-zinc-700 text-zinc-400 text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all">
                                <i data-lucide="trash-2" class="w-3 h-3 inline mr-1"></i> CLEAR
                            </button>
                        </div>
                    </div>

                    <!-- Target Cards Grid -->
                    <div id="vault-cards-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        <!-- Cards will be dynamically inserted here -->
                    </div>

                    <div id="vault-empty-state"
                        class="hidden flex flex-col items-center justify-center h-full text-center">
                        <i data-lucide="archive" class="w-16 h-16 text-zinc-700 mb-4"></i>
                        <p class="text-zinc-500 text-[10px] font-bold uppercase tracking-widest">No Intel Captured
                        </p>
                        <p class="text-zinc-600 text-[9px] mt-2">Use TARGET CAM to capture reconnaissance photos</p>
                    </div>
                </div>

                <!-- TARGET PHOTO DETAIL MODAL (MIL/MOA Measurement) -->
                <div id="target-detail-modal" class="hidden fixed inset-0 bg-black/95 z-50 flex flex-col">
                    <!-- Header -->
                    <div class="bg-zinc-900/90 border-b border-white/10 p-3 flex justify-between items-center shrink-0">
                        <div class="flex items-center gap-3">
                            <button onclick="window.closeTargetDetail()" class="text-zinc-400 hover:text-white">
                                <i data-lucide="x" class="w-5 h-5"></i>
                            </button>
                            <h3 class="text-[10px] font-black text-blue-500 uppercase tracking-widest">Target Analysis
                            </h3>
                        </div>
                        <div class="flex gap-2">
                            <button id="measure-mode-btn" onclick="window.toggleMeasureMode()"
                                class="bg-blue-600 hover:bg-blue-500 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all">
                                <i data-lucide="ruler" class="w-3 h-3 inline mr-1"></i> MEASURE
                            </button>
                            <button id="dimension-toggle-btn" onclick="window.toggleDimension()"
                                class="bg-zinc-700 hover:bg-zinc-600 text-white text-[9px] font-black px-2 py-1.5 rounded uppercase tracking-widest transition-all">
                                H
                            </button>
                            <button id="calibration-mode-btn" onclick="window.toggleCalibrationMode()"
                                class="bg-purple-600 hover:bg-purple-500 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all">
                                <i data-lucide="crosshair" class="w-3 h-3 inline mr-1"></i> CALIBRATE
                            </button>
                            <button onclick="window.sendToDope()"
                                class="bg-green-600 hover:bg-green-500 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all">
                                <i data-lucide="target" class="w-3 h-3 inline mr-1"></i> SEND TO DOPE
                            </button>
                        </div>
                    </div>

                    <!-- Photo Container -->
                    <div class="flex-1 relative overflow-hidden flex items-center justify-center">
                        <img id="detail-photo" class="max-w-full max-h-full object-contain" />

                        <!-- Measurement Box Overlay -->
                        <canvas id="measurement-canvas"
                            class="absolute inset-0 w-full h-full pointer-events-none"></canvas>

                        <!-- MIL/MOA Reading Display -->
                        <div id="mil-reading-display"
                            class="hidden absolute top-4 left-4 bg-black/80 p-3 rounded-lg border border-blue-500/50">
                            <div class="text-[9px] font-mono text-green-400 space-y-1">
                                <div>MIL: <span id="mil-value" class="font-black text-blue-400">--</span></div>
                                <div>MOA: <span id="moa-value" class="font-black text-blue-400">--</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Control Panel -->
                    <div class="bg-zinc-900/90 border-t border-white/10 p-4 shrink-0">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <!-- Target Size Input with Presets -->
                            <div class="bg-zinc-800 p-2 rounded">
                                <label for="target-size-input"
                                    class="text-[8px] text-zinc-500 uppercase font-black">Target Size (in)</label>
                                <div class="flex gap-1 mt-1">
                                    <input type="number" id="target-size-input" placeholder="18"
                                        class="flex-1 bg-transparent text-white text-sm font-black border-none focus:outline-none"
                                        oninput="window.calculateRange()" />
                                    <button onclick="window.setTargetSize(6.14)"
                                        class="text-[8px] px-1 bg-green-600 hover:bg-green-500 rounded font-black">$</button>
                                    <button onclick="window.setTargetSize(3.37)"
                                        class="text-[8px] px-1 bg-blue-600 hover:bg-blue-500 rounded font-black">üí≥</button>
                                </div>
                            </div>

                            <!-- Calculated Range with Status -->
                            <div class="bg-zinc-800 p-2 rounded">
                                <span class="text-[8px] text-zinc-500 uppercase font-black">Range (yards)</span>
                                <div class="flex items-center gap-2 mt-1">
                                    <div id="calculated-range" class="text-green-400 text-lg font-black">--</div>
                                    <div id="range-status" class="text-[7px] font-black"></div>
                                </div>
                            </div>

                            <!-- Precision Nudge & Reticle -->
                            <div class="bg-zinc-800 p-2 rounded col-span-2">
                                <span class="text-[8px] text-zinc-500 uppercase font-black">Digital MIL-Caliper /
                                    Reticle</span>
                                <div class="flex gap-2 mt-1">
                                    <div class="flex bg-black/40 rounded p-1 border border-white/5 gap-2">
                                        <button onclick="window.nudgeMeasure(-1)"
                                            class="p-1 hover:bg-white/10 rounded text-blue-400">
                                            <i data-lucide="minus-square" class="w-4 h-4"></i>
                                        </button>
                                        <button onclick="window.nudgeMeasure(1)"
                                            class="p-1 hover:bg-white/10 rounded text-blue-400">
                                            <i data-lucide="plus-square" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                    <label for="reticle-type-select" class="sr-only">Reticle Type</label>
                                    <select id="reticle-type-select" onchange="window.updateReticleType(this.value)"
                                        class="flex-1 bg-black/40 text-[9px] text-white font-black uppercase border border-white/10 rounded px-2 outline-none focus:border-blue-500">
                                        <option value="box">Standard Box</option>
                                        <option value="mildot">MIL-Dot (Classic)</option>
                                        <option value="aprs11">Athlon APRS11</option>
                                    </select>
                                    <button id="poi-tag-btn" onclick="window.togglePOITagging()"
                                        class="bg-blue-600/20 hover:bg-blue-600/40 text-blue-400 border border-blue-500/30 px-3 rounded uppercase text-[8px] font-black transition-all">
                                        <i data-lucide="map-pin" class="w-3 h-3 inline mr-1"></i> POI
                                    </button>
                                </div>
                            </div>

                            <!-- Object Size (Calibrated) -->
                            <div class="bg-zinc-800 p-2 rounded col-span-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-[8px] text-zinc-500 uppercase font-black">Ref Calibrated / Object
                                        Size (in)</span>
                                    <button onclick="window.requestFOVCal()"
                                        class="text-[7px] text-purple-400 hover:text-white underline uppercase">Calibrate
                                        FOV</button>
                                </div>
                                <div class="flex items-center gap-2 mt-1">
                                    <div id="object-size-display" class="text-purple-400 text-lg font-black">--</div>
                                    <div id="cal-status" class="text-[7px] font-black text-purple-300">NO CAL</div>
                                </div>
                            </div>

                            <!-- Metadata Display -->
                            <div class="bg-zinc-800 p-2 rounded">
                                <span class="text-[8px] text-zinc-500 uppercase font-black">GPS</span>
                                <div id="detail-gps" class="text-zinc-300 text-[9px] font-mono mt-1">--</div>
                            </div>

                            <div class="bg-zinc-800 p-2 rounded">
                                <span class="text-[8px] text-zinc-500 uppercase font-black">Heading / Angle</span>
                                <div id="detail-heading-angle" class="text-zinc-300 text-[9px] font-mono mt-1">--</div>
                            </div>
                        </div>

                        <!-- Instructions -->
                        <div id="measure-instructions" class="hidden mt-3 text-center text-[9px] text-zinc-500">
                            <i data-lucide="info" class="w-3 h-3 inline mr-1"></i>
                            Click and drag on the photo to measure target height
                        </div>
                    </div>
                </div>

                <!-- FIELD TAPE TAB -->
                <div id="intel-field-tape"
                    class="hidden h-[65vh] flex flex-col landscape:h-full landscape:overflow-hidden w-full bg-black">
                    <!-- Controls Bar (Compact) -->
                    <div class="flex justify-between items-center bg-zinc-900 border-b border-white/10 p-2 shrink-0">
                        <h3 class="text-[10px] font-black text-blue-500 uppercase tracking-widest pl-2">Field Tape</h3>
                        <div class="flex gap-2">
                            <button onclick="window.openTapeArchive()"
                                class="bg-zinc-700 hover:bg-zinc-600 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all flex items-center gap-2">
                                <i data-lucide="archive" class="w-3 h-3"></i> ARCHIVE
                            </button>
                            <label
                                class="bg-blue-600 hover:bg-blue-500 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all cursor-pointer flex items-center gap-2">
                                <i data-lucide="upload" class="w-3 h-3"></i> IMPORT
                                <input type="file" id="field-tape-file-input" accept="video/*" class="hidden"
                                    onchange="window.loadFieldTape(this)">
                            </label>
                            <button onclick="window.exportCurrentTape()"
                                class="bg-zinc-700 hover:bg-zinc-600 text-white text-[9px] font-black px-3 py-1.5 rounded uppercase tracking-widest transition-all flex items-center gap-2">
                                <i data-lucide="share" class="w-3 h-3"></i> EXPORT
                            </button>
                        </div>
                    </div>

                    <!-- Archive Modal (Hidden) -->
                    <div id="tape-archive-modal"
                        class="hidden absolute inset-0 z-50 bg-black/90 backdrop-blur-md flex flex-col p-4">
                        <div class="flex justify-between items-center mb-4 border-b border-white/10 pb-2">
                            <h3 class="text-xs font-black text-white uppercase tracking-widest">SECURE TAPE ARCHIVE</h3>
                            <button onclick="window.closeTapeArchive()" class="text-zinc-400 hover:text-white"><i
                                    data-lucide="x" class="w-5 h-5"></i></button>
                        </div>
                        <div id="tape-list" class="flex-1 overflow-y-auto space-y-2 pr-1">
                            <!-- Tapes will be injected here -->
                            <div class="text-center text-zinc-500 text-[10px] mt-10">NO TAPES SECURED</div>
                        </div>
                    </div>

                    <!-- Ammo Batch Modal (Edit/New) -->
                    <div id="ammo-batch-modal"
                        class="hidden absolute inset-0 z-50 bg-black/90 backdrop-blur-md flex flex-col p-4 items-center justify-center">
                        <div
                            class="bg-zinc-900 border border-white/10 rounded-xl p-6 w-full max-w-sm space-y-4 shadow-2xl">
                            <h3 class="text-xs font-black text-blue-400 uppercase tracking-widest mb-4">BATCH DETAILS
                            </h3>

                            <div class="space-y-1">
                                <label for="batch-name-input" class="text-[9px] text-zinc-500 font-bold uppercase">Batch
                                    Name</label>
                                <input type="text" id="batch-name-input" placeholder="e.g. M118LR 2023"
                                    class="w-full bg-black/40 border border-zinc-700 rounded px-3 py-3 text-xs text-white font-bold outline-none focus:border-blue-500">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="space-y-1">
                                    <label for="batch-mv-input"
                                        class="text-[9px] text-zinc-500 font-bold uppercase">Muzzle Vel (FPS)</label>
                                    <input type="number" id="batch-mv-input" value="2700"
                                        class="w-full bg-black/40 border border-zinc-700 rounded px-3 py-3 text-xs text-white font-mono outline-none focus:border-blue-500">
                                </div>
                                <div class="space-y-1">
                                    <label for="batch-bc-input" class="text-[9px] text-zinc-500 font-bold uppercase">BC
                                        (G1)</label>
                                    <input type="number" id="batch-bc-input" value="0.450" step="0.001"
                                        class="w-full bg-black/40 border border-zinc-700 rounded px-3 py-3 text-xs text-white font-mono outline-none focus:border-blue-500">
                                </div>
                            </div>

                            <div class="space-y-1">
                                <label for="batch-zero-input" class="text-[9px] text-zinc-500 font-bold uppercase">Zero
                                    Range (Y)</label>
                                <input type="number" id="batch-zero-input" value="100"
                                    class="w-full bg-black/40 border border-zinc-700 rounded px-3 py-3 text-xs text-white font-mono outline-none focus:border-blue-500">
                            </div>

                            <div class="flex gap-2 pt-2">
                                <button onclick="document.getElementById('ammo-batch-modal').classList.add('hidden')"
                                    class="flex-1 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 font-black py-3 rounded-lg text-[10px] uppercase">CANCEL</button>
                                <button onclick="window.saveAmmoBatch()"
                                    class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-black py-3 rounded-lg text-[10px] uppercase shadow-lg">SAVE
                                    BATCH</button>
                            </div>
                        </div>
                    </div>

                    <!-- Player Container (Maximized) -->
                    <div class="flex-1 relative overflow-hidden flex items-center justify-center bg-black">
                        <!-- Video Element -->
                        <video id="field-tape-player" controls playsinline loop
                            class="absolute inset-0 w-full h-full object-contain z-10"></video>

                        <!-- Reticle Overlay (Faint) -->
                        <canvas id="field-tape-canvas"
                            class="absolute inset-0 w-full h-full z-20 pointer-events-none opacity-40"></canvas>

                        <!-- Placeholder -->
                        <div id="field-tape-placeholder"
                            class="absolute inset-0 flex flex-col items-center justify-center text-zinc-700 space-y-2 z-0">
                            <i data-lucide="film" class="w-12 h-12 opacity-20"></i>
                            <span class="text-[8px] font-black uppercase opacity-40">NO TAPE LOADED</span>
                        </div>
                    </div>
                </div>

                <!-- 3. SESSION HISTORY TAB -->
                <div id="intel-session-history"
                    class="hidden h-full overflow-y-auto space-y-6 px-2 pb-24 custom-scrollbar">
                    <div
                        class="sticky top-0 z-10 bg-zinc-950/95 backdrop-blur-md border-b border-gray-800 flex gap-2 p-1 rounded-lg overflow-x-auto no-scrollbar">
                        <button id="subtab-quick-dope" onclick="window.switchTacticalModule('quick-dope')"
                            class="flex-1 py-3 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-[var(--input-text)] transition-all rounded bg-blue-900/40 text-[var(--input-text)] min-w-[80px] flex items-center justify-center gap-2">
                            <i data-lucide="file-text" class="w-3.5 h-3.5"></i> Dope
                        </button>
                        <button id="subtab-ammo" onclick="window.switchTacticalModule('ammo')"
                            class="flex-1 py-3 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-[var(--input-text)] transition-all rounded min-w-[80px] flex items-center justify-center gap-2">
                            <i data-lucide="package" class="w-3.5 h-3.5"></i> Ammo
                        </button>
                        <button id="subtab-what-if" onclick="window.switchTacticalModule('what-if')"
                            class="flex-1 py-3 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-[var(--input-text)] transition-all rounded min-w-[80px] flex items-center justify-center gap-2">
                            <i data-lucide="flask-conical" class="w-3.5 h-3.5"></i> Lab
                        </button>
                        <button id="subtab-drills" onclick="window.switchTacticalModule('drills')"
                            class="flex-1 py-3 text-[9px] font-black uppercase tracking-widest text-zinc-500 hover:text-[var(--input-text)] transition-all rounded min-w-[80px] flex items-center justify-center gap-2">
                            <i data-lucide="target" class="w-3.5 h-3.5"></i> Drills
                        </button>
                    </div>

                    <div id="module-ammo">
                        <h3 class="text-xs font-black text-neon-green tracking-[0.3em] uppercase mb-4">v1.3 Tactical
                        </h3>
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-[9px] font-black text-zinc-500 uppercase">BATCHES</h4>
                            <div class="flex gap-2">
                                <button onclick="window.exportAmmoManifestAsImage()"
                                    class="bg-zinc-800 hover:bg-zinc-700 text-[var(--input-text)] text-[9px] font-black px-3 py-2 rounded-lg flex items-center gap-2 transition-all">
                                    <i data-lucide="image" class="w-3 h-3 text-blue-400"></i> SHARE AS IMAGE
                                </button>
                                <button onclick="addNewAmmoBatch()"
                                    class="bg-blue-600 hover:bg-blue-500 text-[var(--input-text)] text-[9px] font-black px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-[0_0_15px_rgba(37,99,235,0.3)]">
                                    <i data-lucide="plus" class="w-3 h-3"></i> NEW BATCH
                                </button>
                            </div>
                        </div>

                        <!-- HIDDEN AMMO CARD FOR IMAGE EXPORT -->
                        <div id="hidden-ammo-card-wrapper"
                            class="fixed -left-[2000px] top-0 opacity-0 pointer-events-none">
                            <div id="ammo-recipe-card"
                                class="w-[800px] bg-white text-black p-8 font-mono border-4 border-black">
                                <div class="flex justify-between items-start border-b-4 border-black pb-4 mb-6">
                                    <div>
                                        <h2 class="text-4xl font-black uppercase tracking-tighter">Tactical Ammo Recipe
                                        </h2>
                                        <p class="text-sm font-bold text-gray-500">OFFICIAL BATCH REPORT</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-[10px] uppercase font-black text-gray-400">TRC PRO v3.0</p>
                                        <div id="ammo-card-timestamp" class="text-xs font-bold"></div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-8">
                                    <div class="space-y-6">
                                        <div>
                                            <h3
                                                class="text-xs font-black bg-black text-white px-2 py-0.5 inline-block mb-1">
                                                BATCH IDENTIFIER</h3>
                                            <p id="ammo-card-name" class="text-3xl font-black uppercase leading-none">
                                            </p>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <h4 class="text-[10px] font-black text-gray-500 uppercase">CALIBER</h4>
                                                <p id="ammo-card-type" class="text-xl font-bold uppercase"></p>
                                            </div>
                                            <div>
                                                <h4 class="text-[10px] font-black text-gray-500 uppercase">RIFLE</h4>
                                                <p id="ammo-card-rifle" class="text-xl font-bold uppercase"></p>
                                            </div>
                                        </div>
                                        <div>
                                            <h4
                                                class="text-[10px] font-black text-gray-500 uppercase border-b border-gray-200">
                                                BULLET SPECIFICATIONS</h4>
                                            <div class="flex justify-between mt-1">
                                                <span class="font-bold">PROJECTILE:</span>
                                                <span id="ammo-card-bullet" class="text-blue-800 font-bold"></span>
                                            </div>
                                            <div class="flex justify-between mt-1">
                                                <span class="font-bold">G1 BALLISTIC COEFF:</span>
                                                <span id="ammo-card-bc" class="text-blue-800 font-bold"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="space-y-4 bg-gray-50 p-6 border-l-4 border-black">
                                        <div class="text-center border-b-2 border-dashed border-gray-300 pb-4 mb-4">
                                            <h4 class="text-[10px] font-black text-gray-500 uppercase mb-1">MUZZLE
                                                VELOCITY</h4>
                                            <p class="text-5xl font-black leading-none"><span
                                                    id="ammo-card-mv"></span><span class="text-lg ml-1">FPS</span></p>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold">POWDER:</span>
                                                <span id="ammo-card-powder" class="font-bold"></span>
                                            </div>
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold">CHARGE WT:</span>
                                                <span id="ammo-card-grains" class="font-bold"></span>
                                            </div>
                                            <div class="flex justify-between text-sm">
                                                <span class="font-bold">BRASS:</span>
                                                <span id="ammo-card-brass" class="font-bold"></span>
                                            </div>
                                            <div class="flex justify-between text-sm pt-2 border-t border-gray-200">
                                                <span class="font-bold">ZERO RANGE:</span>
                                                <span id="ammo-card-zero" class="font-bold text-orange-600"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="mt-8 pt-4 border-t-2 border-gray-200 flex justify-between items-center opacity-50 italic">
                                    <p class="text-[10px]">VERIFIED BALLISTIC LOAD DATA</p>
                                    <p class="text-[10px]">GENERATED VIA TACTICAL RANGE CARD PRO</p>
                                </div>
                            </div>
                        </div>

                        <div id="ammo-log-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-12"></div>
                    </div>

                    <div id="module-drills" class="hidden">
                        <h3 class="text-xs font-black text-orange-400 uppercase tracking-[0.2em] mb-6">Mission
                            Drills
                        </h3>
                        <div id="drill-list-container" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div id="module-what-if" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-emerald-900/10 border border-emerald-500/20 rounded-xl p-5 space-y-4">
                                <h4 class="text-[9px] font-black text-emerald-500 uppercase tracking-widest">
                                    Simulation
                                </h4>
                                <div class="grid gap-3">
                                    <div class="flex flex-col gap-1">
                                        <label for="sim-alt"
                                            class="text-[8px] text-zinc-500 font-bold uppercase ml-1">ALT
                                            (FT)</label>
                                        <div
                                            class="flex items-center bg-black/40 rounded border border-gray-800 overflow-hidden">
                                            <button id="sim-alt-minus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="minus" class="w-3 h-3"></i></button>
                                            <input type="number" id="sim-alt" value="0"
                                                class="bg-transparent text-center text-xs font-black text-[var(--input-text)] w-full outline-none">
                                            <button id="sim-alt-plus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="plus" class="w-3 h-3"></i></button>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <label for="sim-temp"
                                            class="text-[8px] text-zinc-500 font-bold uppercase ml-1">TEMP
                                            (¬∞F)</label>
                                        <div
                                            class="flex items-center bg-neutral-800/40 rounded border border-neutral-500 overflow-hidden">
                                            <button id="sim-temp-minus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="minus" class="w-3 h-3"></i></button>
                                            <input type="number" id="sim-temp" value="59"
                                                class="bg-transparent text-center text-xs font-black text-[var(--input-text)] w-full outline-none">
                                            <button id="sim-temp-plus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="plus" class="w-3 h-3"></i></button>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <label for="sim-hum"
                                            class="text-[8px] text-zinc-500 font-bold uppercase ml-1">HUM
                                            (%)</label>
                                        <div
                                            class="flex items-center bg-neutral-800/40 rounded border border-neutral-500 overflow-hidden">
                                            <button id="sim-hum-minus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="minus" class="w-3 h-3"></i></button>
                                            <input type="number" id="sim-hum" value="50"
                                                class="bg-transparent text-center text-xs font-black text-[var(--input-text)] w-full outline-none">
                                            <button id="sim-hum-plus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="plus" class="w-3 h-3"></i></button>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <label for="sim-press"
                                            class="text-[8px] text-zinc-500 font-bold uppercase ml-1">PRESS
                                            (ALT)</label>
                                        <div
                                            class="flex items-center bg-neutral-800/40 rounded border border-neutral-500 overflow-hidden">
                                            <button id="sim-press-minus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="minus" class="w-3 h-3"></i></button>
                                            <input type="number" id="sim-press" value="29.92" step="0.01"
                                                class="bg-transparent text-center text-xs font-black text-[var(--input-text)] w-full outline-none">
                                            <button id="sim-press-plus"
                                                class="p-2 hover:bg-[var(--input-bg)] text-zinc-400"><i
                                                    data-lucide="plus" class="w-3 h-3"></i></button>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 mt-2">
                                        <button onclick="window.runWhatIf()"
                                            class="flex-1 bg-emerald-600 font-black py-3 rounded text-[10px] uppercase tracking-widest transition-all">RUN
                                            SIM</button>
                                        <button onclick="window.syncLabToHUD()"
                                            class="bg-blue-600 hover:bg-blue-500 text-white font-black px-4 py-3 rounded text-[10px] uppercase tracking-widest transition-all md:px-6">
                                            <i data-lucide="arrow-up-right" class="w-4 h-4 inline md:hidden"></i>
                                            <span class="hidden md:inline">SYNC TO HUD</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="bg-[var(--input-bg)] border border-[var(--input-border)] rounded-xl p-5 flex flex-col items-center justify-center text-center">
                                <canvas id="trajectory-canvas" class="w-full h-32 mb-4"></canvas>
                                <div class="flex gap-4 mb-4">
                                    <div class="text-center">
                                        <p class="text-[6px] text-zinc-600 font-black uppercase">Max Ord</p>
                                        <p id="traj-max-ord"
                                            class="text-[9px] font-black text-[var(--input-text)] uppercase tracking-widest">
                                            ---</p>
                                    </div>
                                    <div class="text-center border-l border-neutral-500 pl-4">
                                        <p class="text-[6px] text-zinc-600 font-black uppercase">Impact</p>
                                        <p id="traj-impact"
                                            class="text-[9px] font-black text-[var(--input-text)] uppercase tracking-widest">
                                            ---</p>
                                    </div>
                                </div>
                                <p class="text-[8px] text-zinc-500 font-black uppercase mb-1">Density Altitude</p>
                                <h2 id="lab-da-val" class="text-2xl font-black text-[var(--input-text)] mb-2">--- FT
                                </h2>
                                <h2 id="sim-shift-val" class="text-lg font-black text-emerald-400">---</h2>
                            </div>
                        </div>
                    </div>

                    <div id="module-quick-dope" class="hidden flex flex-col">
                        <!-- CENTERED STACKED HEADER -->
                        <div class="flex flex-col items-center mb-8 gap-6">
                            <h3
                                class="text-xs font-black text-blue-400 uppercase tracking-[0.3em] border-b border-blue-500/20 pb-2">
                                QUICK DOPE</h3>

                            <!-- ROW 1: SELECTORS (CENTERED) -->
                            <div class="flex flex-wrap justify-center items-center gap-3">
                                <div
                                    class="flex items-center gap-1 bg-neutral-800/40 px-3 py-2 rounded-lg border border-neutral-500/20 shadow-inner">
                                    <span class="text-[7px] text-zinc-500 uppercase font-black">DATA:</span>
                                    <label for="dope-source-select" class="sr-only">Data Source</label>
                                    <select id="dope-source-select" onchange="window.generateQuickDope()"
                                        class="bg-transparent text-blue-400 text-[9px] font-black uppercase outline-none cursor-pointer">
                                        <option value="smart">SMART AUTO</option>
                                        <option value="hud">MAIN HUD</option>
                                        <option value="batch">AMMO BATCH</option>
                                        <option value="live">LIVE SENSOR</option>
                                    </select>
                                </div>
                                <div
                                    class="flex items-center gap-1 bg-neutral-800/40 px-3 py-2 rounded-lg border border-neutral-500/20 shadow-inner">
                                    <span class="text-[7px] text-zinc-500 uppercase font-black">STEP:</span>
                                    <label for="dope-step-select" class="sr-only">Step Size</label>
                                    <select id="dope-step-select" onchange="window.generateQuickDope()"
                                        class="bg-transparent text-orange-400 text-[9px] font-black uppercase outline-none cursor-pointer">
                                        <option value="100">100Y</option>
                                        <option value="50" selected>50Y</option>
                                        <option value="25">25Y</option>
                                        <option value="10">10Y</option>
                                        <option value="5">5Y</option>
                                    </select>
                                </div>
                                <div
                                    class="flex items-center gap-1 bg-neutral-800/40 px-3 py-2 rounded-lg border border-neutral-500/20 shadow-inner">
                                    <span class="text-[7px] text-zinc-500 uppercase font-black">MAX:</span>
                                    <label for="dope-max-select" class="sr-only">Max Range</label>
                                    <select id="dope-max-select" onchange="window.generateQuickDope()"
                                        class="bg-transparent text-emerald-400 text-[9px] font-black uppercase outline-none cursor-pointer">
                                        <option value="800">800Y</option>
                                        <option value="1000">1000Y</option>
                                        <option value="1200" selected>1200Y</option>
                                        <option value="1500">1500Y</option>
                                        <option value="1760">1 MILE</option>
                                        <option value="2000">2000Y</option>
                                        <option value="2500">2500Y</option>
                                    </select>
                                </div>
                            </div>

                            <!-- ROW 2: ACTIONS (CENTERED) -->
                            <div class="flex items-center gap-4">
                                <button onclick="window.generateQuickDope()"
                                    class="bg-blue-600 hover:bg-blue-500 text-[var(--input-text)] text-[10px] font-black px-4 py-2.5 rounded-lg flex items-center gap-2 transition-all shadow-[0_0_20px_rgba(37,99,235,0.3)] active:scale-95">
                                    <i data-lucide="table" class="w-4 h-4"></i> GENERATE
                                </button>
                                <button onclick="window.saveDopeToVault()"
                                    class="bg-emerald-600 hover:bg-emerald-500 text-[var(--input-text)] text-[10px] font-black px-4 py-2.5 rounded-lg flex items-center gap-2 transition-all shadow-lg active:scale-95">
                                    <i data-lucide="save" class="w-4 h-4"></i> SAVE
                                </button>
                                <button onclick="window.openDopeVault()"
                                    class="bg-zinc-800 hover:bg-zinc-700 text-[var(--input-text)] text-[10px] font-black px-4 py-2.5 rounded-lg flex items-center gap-2 transition-all shadow-lg active:scale-95">
                                    <i data-lucide="folder" class="w-4 h-4"></i> VAULT
                                </button>
                            </div>
                        </div>

                        <!-- DOPE VAULT MODAL -->
                        <div id="dopeVaultModal"
                            class="hidden fixed inset-0 z-[100] bg-neutral-900/95 backdrop-blur-xl flex flex-col p-4 md:p-8 overflow-hidden">

                            <!-- Header -->
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h2 class="text-3xl font-black text-white italic tracking-tighter uppercase">Dope
                                        Vault</h2>
                                    <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest mt-1">Saved
                                        Drop Chart Snapshots</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="window.deleteSelectedDope()" id="dope-bulk-delete-btn"
                                        class="hidden p-2 bg-red-600/20 border border-red-500/30 rounded-lg text-red-400 hover:bg-red-600 hover:text-white transition-all">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="window.importDope()"
                                        class="p-2 bg-blue-600/20 border border-blue-500/30 rounded-lg text-blue-400 hover:bg-blue-600 hover:text-white transition-all">
                                        <i data-lucide="upload" class="w-5 h-5"></i>
                                    </button>
                                    <button onclick="window.closeDopeVault()"
                                        class="p-2 bg-red-600/20 border border-red-500/30 rounded-lg text-red-400 hover:bg-red-600 hover:text-white transition-all">
                                        <i data-lucide="x" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- List Container -->
                            <div id="dope-vault-list"
                                class="flex-1 overflow-y-auto custom-scrollbar grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-20">
                                <!-- Items injected here -->
                            </div>

                            <!-- Empty State -->
                            <div id="dope-vault-empty"
                                class="hidden absolute inset-0 flex flex-col items-center justify-center pointer-events-none opacity-20">
                                <i data-lucide="folder-open" class="w-32 h-32 mb-4"></i>
                                <span class="text-xl font-black uppercase italic">Vault is Empty</span>
                            </div>
                        </div>

                        <style>
                            @keyframes dopePulse {
                                0% {
                                    opacity: 1;
                                }

                                50% {
                                    opacity: 0.3;
                                }

                                100% {
                                    opacity: 1;
                                }
                            }

                            .dope-calculating {
                                animation: dopePulse 0.4s ease-out;
                            }
                        </style>

                        <div id="quick-dope-preview"
                            class="overflow-y-auto custom-scrollbar bg-neutral-800 border border-neutral-500 rounded-xl p-4 min-h-[500px]">
                            <div id="dope-table-title" class="mb-4 text-center flex flex-col items-center gap-2"></div>
                            <!-- STANDING ORDER DOPE -->
                            <div class="w-full text-white pb-10" id="dope-render-target">
                                <table class="w-full text-left border-collapse opacity-80 border border-blue-500/30">
                                    <thead>
                                        <tr class="bg-blue-900/40 text-[9px] text-blue-200 uppercase tracking-[0.2em]">
                                            <th class="p-3 border-b border-blue-500/20">RNG</th>
                                            <th class="p-3 border-b border-blue-500/20 text-white">ELEV (MIL)</th>
                                            <th class="p-3 border-b border-blue-500/20 text-orange-400">WIND</th>
                                            <th class="p-3 border-b border-blue-500/20 opacity-50">VEL</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-sm font-mono text-zinc-100 italic">
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">100y</td>
                                            <td class="p-3 font-black">0.0</td>
                                            <td class="p-3 text-orange-400">0.0</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">200y</td>
                                            <td class="p-3 font-black">0.5</td>
                                            <td class="p-3 text-orange-400">0.2</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">300y</td>
                                            <td class="p-3 font-black">1.2</td>
                                            <td class="p-3 text-orange-400">0.4</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">400y</td>
                                            <td class="p-3 font-black">2.1</td>
                                            <td class="p-3 text-orange-400">0.6</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">500y</td>
                                            <td class="p-3 font-black">3.2</td>
                                            <td class="p-3 text-orange-400">0.8</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">600y</td>
                                            <td class="p-3 font-black">4.5</td>
                                            <td class="p-3 text-orange-400">1.0</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">700y</td>
                                            <td class="p-3 font-black">6.0</td>
                                            <td class="p-3 text-orange-400">1.2</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">800y</td>
                                            <td class="p-3 font-black">7.8</td>
                                            <td class="p-3 text-orange-400">1.4</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">900y</td>
                                            <td class="p-3 font-black">10.0</td>
                                            <td class="p-3 text-orange-400">1.6</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">1000y</td>
                                            <td class="p-3 font-black">12.5</td>
                                            <td class="p-3 text-orange-400">1.8</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">1100y</td>
                                            <td class="p-3 font-black">15.5</td>
                                            <td class="p-3 text-orange-400">2.0</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                        <tr class="border-b border-white/5">
                                            <td class="p-3">1200y</td>
                                            <td class="p-3 font-black">19.0</td>
                                            <td class="p-3 text-orange-400">2.2</td>
                                            <td class="p-3 opacity-40">--</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="mt-8 text-center">
                                    <p
                                        class="text-[8px] text-blue-500 font-black uppercase tracking-widest animate-pulse">
                                        Awaiting Live Mission Solve...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ballistic Intel Tab (Virtual Spotter) -->
                <div id="intel-ballistic-intel"
                    class="hidden h-full flex flex-col overflow-y-auto landscape:grid landscape:grid-cols-2 landscape:gap-4 landscape:overflow-hidden custom-scrollbar pb-20">
                    <!-- STICKY SCOPE HEADER -->
                    <div
                        class="sticky top-0 z-30 bg-neutral-800 border-b border-neutral-500 pb-2 landscape:static landscape:h-full landscape:flex landscape:flex-col landscape:border-r landscape:border-neutral-500 landscape:pr-4">
                        <div class="flex justify-between items-center px-4 py-2">
                            <h3
                                class="text-[10px] font-black text-orange-500 uppercase tracking-widest flex items-center gap-2">
                                <i data-lucide="eye" class="w-3.5 h-3.5"></i>
                                VIRTUAL SCOPE VIEW
                            </h3>
                            <div class="flex items-center gap-2">
                                <span class="text-[8px] text-zinc-500 font-bold">‚Ä¢ LIVE FEED</span>
                                <button onclick="window.centerSpotterView()"
                                    class="p-1 hover:bg-[var(--input-bg)] rounded transition-colors text-[8px] font-black text-blue-400 uppercase tracking-widest border border-blue-900/30 px-2"
                                    title="Reset View">
                                    RE-CENTER
                                </button>
                                <button onclick="window.initVirtualSpotter()"
                                    class="p-1 hover:bg-[var(--input-bg)] rounded transition-colors"
                                    title="Sync Simulator">
                                    <i data-lucide="refresh-cw"
                                        class="w-2.5 h-2.5 text-zinc-600 hover:text-[var(--input-text)]"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Canvas Container -->
                        <div
                            class="relative bg-black mx-4 rounded-xl border-2 border-neutral-500 overflow-hidden shadow-inner group landscape:mx-0 landscape:w-full landscape:h-auto landscape:aspect-video">
                            <!-- Scope Ring Effect -->
                            <div
                                class="absolute inset-0 rounded-xl pointer-events-none shadow-[inset_0_0_50px_rgba(0,0,0,0.8)] z-10">
                            </div>

                            <!-- Canvas -->
                            <canvas id="virtual-spotter-canvas"
                                class="w-full h-full object-contain block relative z-0"></canvas>

                            <!-- Data Overlay -->
                            <div class="absolute top-2 left-2 z-20 pointer-events-none">
                                <div
                                    class="bg-[var(--input-bg)]/60 backdrop-blur-sm px-2 py-1 rounded border border-white/10">
                                    <p class="text-[8px] text-zinc-500 font-black uppercase leading-none mb-0.5">
                                        ELEV
                                    </p>
                                    <p id="spotter-elev"
                                        class="text-xs font-mono font-black text-[var(--input-text)] leading-none">
                                        0.0</p>
                                </div>
                            </div>
                            <div class="absolute top-2 right-2 z-20 pointer-events-none text-right">
                                <div
                                    class="bg-[var(--input-bg)]/60 backdrop-blur-sm px-2 py-1 rounded border border-white/10">
                                    <p class="text-[8px] text-zinc-500 font-black uppercase leading-none mb-0.5">
                                        WIND
                                    </p>
                                    <p id="spotter-wind"
                                        class="text-xs font-mono font-black text-[var(--input-text)] leading-none">
                                        0.0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SCROLLABLE CONTROLS AREA -->
                    <div
                        class="flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar landscape:h-full landscape:overflow-y-auto w-full">

                        <!-- Controls -->
                        <div class="space-y-4 bg-neutral-600/50 p-4 rounded-xl border border-neutral-500">
                            <!-- Mode Toggle -->
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-[10px] font-black text-zinc-400 uppercase tracking-widest">Simulator
                                    Mode</span>
                                <div class="flex bg-neutral-600 p-1 rounded-lg border border-neutral-500">
                                    <button id="spotter-mode-auto"
                                        class="px-3 py-1 text-[9px] font-black rounded-md bg-neon-green text-black transition-all">AUTO</button>
                                    <button id="spotter-mode-manual"
                                        class="px-3 py-1 text-[9px] font-black rounded-md text-zinc-500 hover:text-[var(--input-text)] transition-all">MANUAL</button>
                                </div>
                            </div>

                            <!-- Auto Mode Controls (Sliders) -->
                            <div id="spotter-controls-auto" class="space-y-4">
                                <!-- Range Control -->
                                <div class="space-y-1">
                                    <div class="flex justify-between text-[9px] font-black uppercase text-zinc-400">
                                        <label for="spotter-range">Target Range</label>
                                        <span id="spotter-range-val" class="text-[var(--input-text)]">500 YDS</span>
                                    </div>
                                    <input type="range" id="spotter-range" min="0" max="1000" step="10" value="500"
                                        class="w-full h-2 bg-[var(--input-bg)] rounded-lg appearance-none cursor-pointer accent-neon-green">
                                </div>

                                <!-- Wind Control -->
                                <div class="space-y-1">
                                    <div class="flex justify-between text-[9px] font-black uppercase text-zinc-400">
                                        <label for="spotter-wind-slider">Wind Velocity</label>
                                        <span id="spotter-wind-val" class="text-[var(--input-text)]">0 MPH</span>
                                    </div>
                                    <input type="range" id="spotter-wind-slider" min="-20" max="20" step="1" value="0"
                                        class="w-full h-2 bg-[var(--input-bg)] rounded-lg appearance-none cursor-pointer accent-blue-500">
                                </div>
                            </div>

                            <!-- Manual Mode Controls (Direct Entry) -->
                            <div id="spotter-controls-manual" class="hidden space-y-4">
                                <div class="grid grid-cols-2 gap-4">
                                    <!-- Elevation Dial -->
                                    <div class="space-y-1">
                                        <label for="spotter-manual-elev"
                                            class="text-[9px] font-black text-zinc-500 uppercase block mb-1">Dial
                                            Elevation (MOA)</label>
                                        <div class="flex items-center gap-1">
                                            <button id="spotter-manual-elev-minus"
                                                class="w-8 h-8 bg-[var(--input-bg)] rounded border border-gray-800 text-[var(--input-text)] font-black hover:bg-zinc-700">-</button>
                                            <input type="number" id="spotter-manual-elev" step="0.25" value="0.00"
                                                class="flex-1 bg-[var(--input-bg)] border border-[var(--input-border)] rounded h-8 text-[var(--input-text)] font-mono text-center focus:border-neon-green focus:outline-none text-xs">
                                            <button id="spotter-manual-elev-plus"
                                                class="w-8 h-8 bg-[var(--input-bg)] rounded border border-neutral-500 text-[var(--input-text)] font-black hover:bg-zinc-700">+</button>
                                        </div>
                                    </div>
                                    <!-- Windage Dial -->
                                    <div class="space-y-1">
                                        <label for="spotter-manual-wind"
                                            class="text-[9px] font-black text-zinc-500 uppercase block mb-1">Dial
                                            Windage
                                            (MOA)</label>
                                        <div class="flex items-center gap-1">
                                            <button id="spotter-manual-wind-minus"
                                                class="w-8 h-8 bg-[var(--input-bg)] rounded border border-gray-800 text-[var(--input-text)] font-black hover:bg-zinc-700">-</button>
                                            <input type="number" id="spotter-manual-wind" step="0.25" value="0.00"
                                                class="flex-1 bg-[var(--input-bg)] border border-[var(--input-border)] rounded h-8 text-[var(--input-text)] font-mono text-center focus:border-blue-500 focus:outline-none text-xs">
                                            <button id="spotter-manual-wind-plus"
                                                class="w-8 h-8 bg-[var(--input-bg)] rounded border border-neutral-500 text-[var(--input-text)] font-black hover:bg-zinc-700">+</button>
                                        </div>
                                    </div>
                                </div>
                                <p
                                    class="text-[8px] text-zinc-600 font-black uppercase text-center italic tracking-tighter">
                                    Manual entry bypasses Range Card data. Practice your holds!</p>
                            </div>

                            <!-- Reticle Selector -->
                            <div class="flex gap-2 pt-2 border-t border-gray-800 mt-2">
                                <button id="reticle-type-mil"
                                    class="flex-1 py-1 text-[8px] font-black border border-gray-800 rounded bg-[var(--input-bg)] text-[var(--input-text)]">MIL-DOT</button>
                                <button id="reticle-type-moa"
                                    class="flex-1 py-1 text-[8px] font-black border border-transparent rounded text-zinc-500 hover:text-[var(--input-text)]">MOA-GRID</button>
                            </div>

                            <!-- H-MIL RANGE SIMULATOR (UKD TRAINER) -->
                            <div class="mt-6 pt-4 border-t border-neutral-500 space-y-4">
                                <div class="flex items-center justify-between">
                                    <h4
                                        class="text-[10px] font-black text-[var(--input-text)] uppercase tracking-widest flex items-center gap-2">
                                        <i data-lucide="ruler" class="w-3.5 h-3.5 text-orange-500"></i>
                                        UKD Training: H-MIL Simulator
                                    </h4>
                                    <span class="text-[8px] text-zinc-600 font-black uppercase">v1.2 Tactical</span>
                                </div>

                                <!-- Object Selector -->
                                <div
                                    class="bg-[var(--input-bg)] border border-[var(--input-border)] rounded-lg p-3 space-y-3">
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="space-y-1">
                                            <label for="hmil-target-type"
                                                class="text-[8px] text-zinc-500 font-bold uppercase">Tactical
                                                Object</label>
                                            <select id="hmil-target-type"
                                                class="w-full bg-[var(--input-bg)] border border-gray-800 rounded h-10 text-[10px] text-[var(--input-text)] font-black uppercase px-2 outline-none focus:border-orange-500">
                                                <option value="ladder">6ft Stepladder (W: 3ft)</option>
                                                <option value="silhouette">IPSC Silhouette (H: 30")</option>
                                                <option value="barrel">55 Gal Drum (H: 35")</option>
                                                <option value="vehicle">Standard Sedan (W: 70")</option>
                                            </select>
                                        </div>
                                        <div class="space-y-1">
                                            <span class="text-[8px] text-zinc-500 font-bold uppercase">Scope Aiming
                                                (Pan)</span>
                                            <div class="grid grid-cols-3 gap-1">
                                                <div class="col-start-2">
                                                    <button onclick="window.nudgeHMIL('up')"
                                                        class="w-full aspect-square bg-[var(--input-bg)] hover:bg-zinc-700 rounded flex items-center justify-center border border-neutral-500">
                                                        <i data-lucide="chevron-up"
                                                            class="w-3 h-3 text-[var(--input-text)]"></i>
                                                    </button>
                                                </div>
                                                <div class="row-start-2 col-start-1">
                                                    <button onclick="window.nudgeHMIL('left')"
                                                        class="w-full aspect-square bg-[var(--input-bg)] hover:bg-zinc-700 rounded flex items-center justify-center border border-neutral-500">
                                                        <i data-lucide="chevron-left"
                                                            class="w-3 h-3 text-[var(--input-text)]"></i>
                                                    </button>
                                                </div>
                                                <div class="row-start-2 col-start-2">
                                                    <button onclick="window.nudgeHMIL('down')"
                                                        class="w-full aspect-square bg-[var(--input-bg)] hover:bg-zinc-700 rounded flex items-center justify-center border border-neutral-500">
                                                        <i data-lucide="chevron-down"
                                                            class="w-3 h-3 text-[var(--input-text)]"></i>
                                                    </button>
                                                </div>
                                                <div class="row-start-2 col-start-3">
                                                    <button onclick="window.nudgeHMIL('right')"
                                                        class="w-full aspect-square bg-[var(--input-bg)] hover:bg-zinc-700 rounded flex items-center justify-center border border-neutral-500">
                                                        <i data-lucide="chevron-right"
                                                            class="w-3 h-3 text-[var(--input-text)]"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Solution Entry -->
                                    <div class="grid grid-cols-2 gap-3 pt-2">
                                        <div class="space-y-1">
                                            <label for="hmil-user-dist"
                                                class="text-[8px] text-zinc-500 font-bold uppercase">Est.
                                                Distance
                                                (YDS)</label>
                                            <input type="number" id="hmil-user-dist" placeholder="000"
                                                class="w-full bg-black border border-neutral-500 rounded h-10 text-orange-500 font-mono text-center focus:border-orange-500 outline-none text-sm font-black">
                                        </div>
                                        <div class="grid grid-cols-1 gap-1">
                                            <button onclick="window.spawnHMILTarget()"
                                                class="w-full bg-orange-600 hover:bg-orange-500 text-[var(--input-text)] font-black h-6 rounded uppercase text-[8px] tracking-widest transition-all">
                                                NEW SCENARIO
                                            </button>
                                            <button onclick="window.resetHMILCurrent()"
                                                class="w-full bg-[var(--input-bg)] hover:bg-zinc-700 text-zinc-400 font-black h-4 rounded uppercase text-[7px] tracking-widest transition-all">
                                                TRY AGAIN
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Formula & Verification -->
                                <div class="space-y-2">
                                    <button onclick="window.verifyHMILSolution()"
                                        class="w-full bg-neutral-600 hover:bg-neutral-500 border border-neutral-500 text-zinc-300 font-black py-3 rounded-lg text-[9px] uppercase tracking-widest transition-all flex items-center justify-center gap-2">
                                        <i data-lucide="calculator" class="w-3.5 h-3.5"></i>
                                        Verify Solution & Reveal Math
                                    </button>

                                    <div id="hmil-math-reveal"
                                        class="hidden bg-orange-950/20 border border-orange-500/30 rounded-lg p-3 font-mono text-[9px] text-orange-400 space-y-2">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>

                                <!-- Formula Table -->
                                <div class="bg-neutral-800/40 border border-neutral-500 rounded overflow-hidden">
                                    <table class="w-full text-[8px] text-zinc-500 uppercase font-black">
                                        <thead class="bg-neutral-600/50 border-b border-neutral-500">
                                            <tr>
                                                <th class="p-1 px-2 text-left">UNIT</th>
                                                <th class="p-1 text-left">RANGE FORMULA (YARDS)</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-zinc-800/30">
                                            <tr>
                                                <td class="p-1 px-2 text-zinc-400">FEET</td>
                                                <td class="p-1">(Size * 333.3) / MILs</td>
                                            </tr>
                                            <tr>
                                                <td class="p-1 px-2 text-zinc-400">INCHES</td>
                                                <td class="p-1">(Size * 27.77) / MILs</td>
                                            </tr>
                                            <tr>
                                                <td class="p-1 px-2 text-zinc-400">YARDS</td>
                                                <td class="p-1">(Size * 1000) / MILs</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>




                    </div>

                    <!-- Footer -->
                    <div
                        class="p-4 bg-neutral-800/40 border-b border-neutral-500 flex justify-between items-center text-[10px] text-gray-500 font-mono shrink-0">
                        <span>SYSTEM VERSION 1.0 // ADVISOR ONLINE</span>
                        <span class="text-blue-900 font-black animate-pulse">‚óè SIGNAL SECURE</span>
                    </div>
                </div>
            </div>

            <!-- Ballistic Library Modal (Secondary) -->
            <div id="weaponProfileModal"
                class="fixed inset-0 bg-neutral-900/80 backdrop-blur-sm z-[250] flex items-center justify-center p-4 hidden">
                <div
                    class="bg-neutral-700 border border-neutral-500 rounded-lg w-full max-w-md max-h-[80vh] flex flex-col shadow-2xl">
                    <!-- Header -->
                    <div class="bg-neutral-600/40 border-b border-neutral-500 p-4 flex justify-between items-center">
                        <h3 class="text-sm font-bold text-white uppercase tracking-wider flex items-center gap-2">
                            <i data-lucide="library" class="w-4 h-4 text-neon-green"></i>
                            Ballistic Library
                        </h3>
                        <button onclick="closeLibrary()"
                            class="text-gray-400 hover:text-[var(--text-primary)] transition-colors">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <!-- Content -->
                    <div class="p-4 overflow-y-auto custom-scrollbar flex-1 space-y-6">
                        <!-- Card Model Selection -->
                        <div class="space-y-4">
                            <span class="section-label flex items-center gap-2">
                                <i data-lucide="layout-template" class="w-3 h-3 text-neon-green"></i>
                                Tactical Card Models
                            </span>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setCardModel('standard')" id="card-model-standard"
                                    class="card-model-btn p-2 rounded-lg border border-neutral-600 bg-neutral-800/40 text-left transition-all hover:border-neon-green hover:bg-neon-green/5">
                                    <p class="text-[10px] font-bold text-[var(--text-primary)] uppercase">The
                                        Tactical</p>
                                    <p class="text-[8px] text-gray-500 uppercase tracking-tighter">
                                        Standard 2x3 Dope</p>
                                </button>
                                <button onclick="setCardModel('recon')" id="card-model-recon"
                                    class="card-model-btn p-2 rounded-lg border border-neutral-600 bg-neutral-800/40 text-left transition-all hover:border-yellow-500 hover:bg-yellow-500/5">
                                    <p class="text-[10px] font-bold text-[var(--text-primary)] uppercase">The Recon
                                    </p>
                                    <p class="text-[8px] text-gray-500 uppercase tracking-tighter">
                                        Long Range Prec</p>
                                </button>
                                <button onclick="setCardModel('challenger')" id="card-model-challenger"
                                    class="card-model-btn p-2 rounded-lg border border-neutral-600 bg-neutral-800/40 text-left transition-all hover:border-purple-500 hover:bg-purple-500/5">
                                    <p class="text-[10px] font-bold text-[var(--text-primary)] uppercase">The
                                        Challenger</p>
                                    <p class="text-[8px] text-gray-500 uppercase tracking-tighter">
                                        Match & Stage</p>
                                </button>
                                <button onclick="setCardModel('stalker')" id="card-model-stalker"
                                    class="card-model-btn p-2 rounded-lg border border-neutral-600 bg-neutral-800/40 text-left transition-all hover:border-orange-500 hover:bg-orange-500/5">
                                    <p class="text-[10px] font-bold text-[var(--text-primary)] uppercase">The
                                        Stalker</p>
                                    <p class="text-[8px] text-gray-500 uppercase tracking-tighter">
                                        Hunter Essentials</p>
                                </button>
                                <button onclick="setCardModel('spotter')" id="card-model-spotter"
                                    class="col-span-2 card-model-btn p-2 rounded-lg border border-neutral-600 bg-neutral-800/40 text-left transition-all hover:border-yellow-500 hover:bg-yellow-500/5">
                                    <p class="text-[10px] font-bold text-[var(--text-primary)] uppercase text-center">
                                        The Spotter Intel Card</p>
                                    <p class="text-[8px] text-gray-500 uppercase tracking-tighter text-center">
                                        Observation Log
                                </button>
                            </div>

                            <!-- Live Model Preview -->
                            <div
                                class="bg-neutral-800 border border-neutral-500 p-4 flex flex-col items-center justify-center min-h-[160px] relative overflow-hidden group">
                                <div class="absolute top-2 left-2 flex items-center gap-1 opacity-20">
                                    <div class="w-1 h-1 bg-neon-green rounded-full animate-pulse">
                                    </div>
                                    <span
                                        class="text-[8px] font-mono text-[var(--text-primary)]">LIVE_PREVIEW_SIGNAL</span>
                                </div>
                                <div id="card-model-preview-container"
                                    class="w-60 h-40 transform scale-90 sm:scale-100 transition-transform">
                                    <!-- Injected by JS -->
                                </div>
                            </div>

                            <!-- Apply Action -->
                            <button onclick="closeLibrary()"
                                class="w-full bg-neon-green/10 hover:bg-neon-green/20 border border-neon-green/30 text-neon-green font-bold py-3 rounded-lg transition-all uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-2">
                                <i data-lucide="check-circle" class="w-4 h-4"></i>
                                Apply Selection & Close
                            </button>
                        </div>

                        <!-- Profile Selector -->
                        <div>
                            <span class="section-label">Active Profile</span>
                            <select id="modal-weapon-profile-select" class="input-field w-full"
                                onchange="WeaponProfiles.load(this.value)">
                                <option value="">-- Select Profile --</option>
                            </select>
                        </div>

                        <!-- List -->
                        <div>
                            <span class="section-label">Saved Profiles</span>
                            <div id="weapon-profiles-list" class="space-y-2 mt-2">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="grid grid-cols-1 gap-2 pt-2">
                            <button onclick="saveCurrentAsWeaponProfile()"
                                class="bg-blue-900/40 border border-blue-700/50 hover:bg-blue-800 p-2 rounded text-xs font-bold text-blue-300 uppercase flex items-center justify-center gap-2">
                                <i data-lucide="plus" class="w-4 h-4"></i> New Profile from Current
                                Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Map Logic -->
            <script>
                // REMOVED WATCHDOG TO PREVENT RACE CONDITIONS
                // Map is handled exclusively by switchIntelTab and map_logic.js
            </script>
            <script src="script.js"></script>
            <!-- <script src="map_logic.js"></script> -->
            <script src="card_templates.js"></script>
            <script src="phase3_functions.js"></script>
            <script> lucide.createIcons(); </script>
            <script>
                // MOBILE DEBUGGER - Displays errors on screen for phones
                function showDebug(msg) {
                    const debugDiv = document.getElementById('mobile-debug-log') || (function () {
                        const div = document.createElement('div');
                        div.id = 'mobile-debug-log';
                        div.style = 'position:fixed;top:0;left:0;width:100%;background:rgba(255,0,0,0.9);color:white;z-index:9999;font-size:10px;padding:10px;pointer-events:none;word-break:break-all;';
                        document.body.appendChild(div);
                        return div;
                    })();
                    debugDiv.innerHTML += '<div>' + msg + '</div>';
                }

                window.onerror = function (msg, url, line) {
                    showDebug('ERROR: ' + msg + ' (L:' + line + ')');
                    return false;
                };

                window.onunhandledrejection = function (event) {
                    showDebug('PROMISE ERROR: ' + (event.reason?.message || event.reason || 'Unknown Rejection'));
                };

                if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
                    window.addEventListener('load', () => {
                        navigator.serviceWorker.register('sw.js')
                            .then(reg => console.log('SW Registered'))
                            .catch(err => showDebug('SW FAILED: ' + err));
                    });
                }
            </script>
</body>

</html>